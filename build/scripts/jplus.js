(function(g,h){var i=g.document,Object=g.Object,ap=Array.prototype,toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,emptyObj={},JPlus=g.JPlus={Base:Base,Native:function(constructor){return extend(constructor,classMembers)},id:1,version:/*@VERSION*/1.00},classMembers={implement:function(members){assert(this.prototype,"MyClass.implement(members): 无法扩展当前类，因为当前类的 prototype 为空。");Object.extend(this.prototype,members);return this;},implementIf:function(members){assert(this.prototype,"MyClass.implementIf(members): 无法扩展当前类，因为当前类的 prototype 为空。");Object.extendIf(this.prototype,members);return this;},defineMethods:function(targetProperty,methods,args){assert.isString(methods,"MyClass.defineMethods(targetProperty, methods): {methods} ~");var propertyGetterFunc;if(/\(\)$/.test(targetProperty)){propertyGetterFunc=targetProperty.substr(0,targetProperty.length-2)}return this.implement(Object.map(methods,function(e){return function(a,b,c){var d=propertyGetterFunc?this[propertyGetterFunc]():this[targetProperty],r;assert(d,"#"+targetProperty+" 不能为空。");assert(!d||d[e],"#"+targetProperty+"."+e+"(): 不是函数。");r=d[e];r=r.apply?r.apply(d,arguments):r(a,b,c);return d===r||r===h?this:r}},{}),args)},addEvents:function(d,e){assert.isString(d,"MyClass.addEvents(eventName, properties): {eventName} ~");var f=this.$event||(this.$event={}),defaultEvent=f.$default;if(e){Object.extendIf(e,defaultEvent);if(e.base){assert(defaultEvent,"使用 base 字段功能必须预先定义 $default 事件。");e.add=function(a,b,c){defaultEvent.add(a,this.base,c)};e.remove=function(a,b,c){defaultEvent.remove(a,this.base,c)}}}else{e=defaultEvent||emptyObj}Object.map(d,e,f);return this},extend:function(a){var b=a&&a.hasOwnProperty("constructor")?a.constructor:function(){arguments.callee.base.apply(this,arguments)};emptyFn.prototype=(b.base=this).prototype;b.prototype=Object.extend(new emptyFn,a);b.prototype.constructor=b;emptyFn.prototype=null;return JPlus.Native(b)}};extend(Object,{extend:(function(){for(var c in{toString:1})return extend;JPlus.enumerables="toString hasOwnProperty valueOf constructor isPrototypeOf".split(' ');return function(a,b){if(b){assert(a!=null,"Object.extend(dest, src): {dest} 不可为空。",a);for(var i=JPlus.enumerables.length,value;i--;)if(hasOwnProperty.call(b,value=JPlus.enumerables[i]))a[value]=b[value];extend(a,b)}return a}})(),extendIf:function(a,c){assert(a!=null,"Object.extendIf(dest, src): {dest} 不可为空。",a);for(var b in c)if(a[b]===undefined)a[b]=c[b];return a},each:function(a,b,c){assert(typeof a!=='function',"Object.each(iterable, fn, scope): {iterable} 不能是函数。 ",a);assert(typeof b==='function',"Object.each(iterable, fn, scope): {fn} 必须是函数。",b);if(a!=null){if(typeof a.length!=="number"){for(var d in a)if(b.call(c,a[d],d,a)===false)return false}else{return each.call(a,b,c)}}return true},map:function(d,e,f){var g;if(typeof d==='string'){d=d.split(' ');g=typeof e==='function'?f?function(a,b,c){this[a]=e(a,b,c)}:e:function(a){this[a]=e}}else{f=typeof d.length!=="number"?{}:[];g=function(a,b,c){this[b]=e(a,b,c)}}Object.each(d,g,f);return f}});Function.empty=emptyFn;String.format=function(d,e){assert(!d||d.replace,'String.format(formatString, args): {formatString} 必须是字符串。',d);var toString=this;e=arguments.length===2&&e&&typeof e==='object'?e:ap.slice.call(arguments,1);return d?d.replace(/\{+?(\S*?)\}+/g,function(a,b){var c=a.charAt(1)=='{',end=a.charAt(a.length-2)=='}';if(c||end)return a.slice(c,a.length-end);return b in e?toString(e[b]):""}):""};if(!Array.isArray){Array.isArray=function(a){return toString.call(a)==="[object Array]"}}if(!Date.now){Date.now=function(){return+new Date}}window.Class=function(a){return Base.extend(a)};if(!window.execScript){window.execScript=function(a){assert.isString(a,"execScript(statements): {statements} ~");window["eval"].call(window,a)}}(function(a){var b=a.userAgent,match=b.match(/(IE|Firefox|Chrome|Safari|Opera)[\/\s]([\w\.]*)/i)||b.match(/(WebKit|Gecko)[\/\s]([\w\.]*)/i)||[0,"",0],browser=match[1],isStd=!!+"\v1";a["is"+browser]=a["is"+browser+parseInt(match[2])]=true;extend(a,{isStd:isStd,isQuirks:!isStd&&typeof document.constructor!=='object',name:browser,version:match[2]})})(window.navigator);each.call([String,Array,Function,Date,Base],JPlus.Native);Base.implement({dataField:function(){return this.$data||(this.$data={})},base:function(a){var b=this.constructor,fn=this[a],oldFn=fn,args=arguments;assert(fn,"JPlus.Base#base(fnName, args): 子类不存在 {fnName} 的属性或方法。",a);fn.$bubble=true;assert(!b||b.prototype[a],"JPlus.Base#base(fnName, args): 父类不存在 {fnName} 的方法。",a);do{b=b.base;assert(b&&b.prototype[a],"JPlus.Base#base(fnName, args): 父类不存在 {fnName} 的方法。",a)}while('$bubble'in(fn=b.prototype[a]));assert.isFunction(fn,"JPlus.Base#base(fnName, args): 父类的成员 {fn}不是一个函数。  ");fn.$bubble=true;try{if(args.length<=1)return fn.apply(this,args.callee.caller.arguments);args[0]=this;return fn.call.apply(fn,args)}finally{delete fn.$bubble;delete oldFn.$bubble}},on:function(b,c,d){assert.isFunction(c,'JPlus.Base#on(eventName, eventHandler, scope): {eventHandler} ~');var f=this,data=f.dataField(),eventListener,eventManager;data=data.$event||(data.$event={});eventListener=data[b];d=[c,d||f];if(!eventListener){eventManager=getMgr(f,b);data[b]=eventListener=function(e){var a=arguments.callee,handlers=a.handlers.slice(0),handler,i=-1,length=handlers.length;while(++i<length){handler=handlers[i];if(handler[0].call(handler[1],e)===false){if(handler[2]!==true&&(handler=a.stop)){handler[0].call(handler[1],e)}return false}}return true};eventListener.handlers=eventManager.initEvent?[[eventManager.initEvent,f,true],d]:[d];if(eventManager.stopEvent){eventListener.stop=[eventManager.stopEvent,f]}if(eventManager.add){eventManager.add(f,b,eventListener)}}else{eventListener.handlers.push(d)}return f},trigger:function(a,e){var b=this,data=b.dataField().$event,eventManager;return!data||!(data=data[a])||((eventManager=getMgr(b,a)).dispatch?eventManager.dispatch(b,a,data,e):data(e))},un:function(a,b){assert(!b||typeof b==='function','JPlus.Base#un(eventName, eventHandler): {eventHandler} 必须是函数。',b);var c=this,data=c.dataField().$event,eventListener,handlers,i;if(data){if(eventListener=data[a]){if(b){handlers=eventListener.handlers;i=handlers.length;while(i-->0){if(handlers[i][0]===b){handlers.splice(i,1);if(!i||(i===1&&handlers[0]===true)){b=0}break}}}if(!b){delete data[a];data=getMgr(c,a);if(data.remove)data.remove(c,a,eventListener)}}else if(!a){for(a in data)c.un(a)}}return c},once:function(a,b,c){assert.isFunction(b,'JPlus.Base#once(eventName, eventHandler): {eventHandler} ~');return this.on(a,function(){this.un(a,b).un(a,arguments.callee)}).on(a,b,c)}});String.implementIf({trim:function(){return this.replace(/^[\s\u00A0]+|[\s\u00A0]+$/g,"")},toCamelCase:function(){return this.replace(/-(\w)/g,toUpperCase)},capitalize:function(){return this.replace(/(\b[a-z])/g,toUpperCase)}});Function.implementIf({bind:function(a){var b=this;return function(){return b.apply(a,arguments)}}});Array.implementIf({each:each,include:function(a){var b=this.indexOf(a)>=0;if(!b)this.push(a);return b},invoke:function(b,c){assert(!c||typeof c.length==='number',"Array#invoke(fnName, args): {args} 必须是参数数组。",c);var r=[];ap.forEach.call(this,function(a){assert(a!=null&&a[b]&&a[b].apply,"Array#invoke(fnName, args): {value} 不包含函数 {fnName}。",a,b);r.push(a[b].apply(a,c||[]))});return r},unique:function(){for(var i=0,j,value;i<this.length;){value=this[i];j=++i;do{j=ap.remove.call(this,value,j)}while(j>=0)}return this},remove:function(a,b){var i=ap.indexOf.call(this,a,b);if(i!==-1)ap.splice.call(this,i,1);return i},item:function(a){return this[a<0?this.length+a:a]},indexOf:function(a,b){b=b||0;for(var c=this.length;b<c;b++)if(this[b]===a)return b;return-1},filter:function(c,d){assert.isFunction(c,"Array#filter(fn, scope): {fn} ~");var r=[];ap.forEach.call(this,function(a,i,b){if(c.call(d,a,i,b))r.push(a)});return r},forEach:each});function extend(a,b){assert(a!=null,"Object.extend(dest, src): {dest} 不可为空。",a);for(var c in b)a[c]=b[c];return a}function each(a,b){assert(typeof a==='function',"Array#each(fn, scope): {fn} 必须是一个函数。",a);var i=-1,me=this;while(++i<me.length)if(a.call(b,me[i],i,me)===false)return false;return true}function Base(){}function emptyFn(){}function toUpperCase(a,b){return b.toUpperCase()}function getMgr(a,b){var c=a.constructor,t;while(!(t=c.$event)||!(b in t)){if(!(c=c.base)){return emptyObj}}return t[b]}})(this);JPlus.Base.prototype.toString=function(){for(var a in window){if(window[a]===this.constructor)return a}return Object.prototype.toString.call(this)};function trace(){if(arguments.length===0){if(!trace.$count)return trace('(trace: '+(trace.$count++)+')')}if(trace.enable){var a=window.console,data;if(a&&console.debug&&console.debug.apply){return console.debug.apply(console,arguments)}if(a&&console.log&&console.log.apply){return console.log.apply(console,arguments)}for(var i=0,r=[];i<arguments.length;i++){r[i]=trace.inspect(arguments[i])}data=r.join(' ');return a&&console.log?console.log(data):alert(data)}}function assert(c,d){if(!c){var e=arguments;switch(e.length){case 1:d="断言失败";case 2:break;case 0:return true;default:var i=2;d=d.replace(/\{([\w\.\(\)]*?)\}/g,function(a,b){return"参数 "+(e.length<=i?a:b+" = "+trace.ellipsis(trace.inspect(e[i++]),200))})}if(assert.stackTrace){e=e.callee.caller;while(e&&e.debugStepThrough)e=e.caller;if(e&&e.caller){e=e.caller}if(e)d+="\r\n--------------------------------------------------------------------\r\n"+trace.ellipsis(trace.decodeUTF8(e.toString()),600)}window.trace.error(d)}return!!c}function using(a,b){assert.isString(a,"using(ns): {ns} 不是合法的组件全名。");var c=using[b?'styles':'scripts'];for(var i=0;i<c.length;i++){if(c[i]===a)return}c.push(a);a=using.resolve(a,b);var d,type,exts,callback;if(b){d="LINK";type="href";exts=[".css"];callback=using.loadStyle}else{d="SCRIPT";type="src";exts=[".js"];callback=using.loadScript}var e=document.getElementsByTagName(d),path=a.replace(/^[\.\/\\]+/,"");for(var i=0;e[i];i++){var f=((document.constructor?e[i][type]:e[i].getAttribute(type,4))||'');for(var j=0;j<exts.length;j++){if(f.indexOf(path+exts[j])>=0){return}}}callback(using.rootPath+a+exts[0])}function imports(a){return using(a,true)}(function(){extend(trace,{enable:true,ellipsis:function(a,b){return a.length>b?a.substr(0,b-3)+"...":a},decodeUTF8:function(s){return s.replace(/\\u([0-9a-f]{3})([0-9a-f])/gi,function(a,b,c){return String.fromCharCode((parseInt(b,16)*16+parseInt(c,16)))})},inspect:function(a,b,c){if(b==null)b=3;switch(typeof a){case"function":return b>=3?trace.decodeUTF8(a.toString()):"function ()";case"object":if(a==null)return"null";if(b<0)return a.toString();if(typeof a.length==="number"){var r=[];for(var i=0;i<a.length;i++){r.push(trace.inspect(a[i],++b))}return c?r.join("   "):("["+r.join(", ")+"]")}else{if(a.setInterval&&a.resizeTo)return"window#"+a.document.URL;if(a.nodeType){if(a.nodeType==9)return'document '+a.URL;if(a.tagName){var d=a.tagName.toLowerCase(),r=d;if(a.id){r+="#"+a.id;if(a.className)r+="."+a.className}else if(a.outerHTML)r=a.outerHTML;else{if(a.className)r+=" class=\"."+a.className+"\"";r="<"+r+">"+a.innerHTML+"</"+d+">  "}return r}return'[Node type='+a.nodeType+' name='+a.nodeName+' value='+a.nodeValue+']'}var r="{\r\n",i,flag=0;for(i in a){if(typeof a[i]!=='function')r+="\t"+i+" = "+trace.inspect(a[i],b-1)+"\r\n";else{flag++}}if(flag){r+='\t... ('+flag+'个函数)\r\n'}r+="}";return r}case"string":return b>=3?a:'"'+a+'"';case"undefined":return"undefined";default:return a.toString()}},log:function(a){if(trace.enable&&window.console&&console.log){window.console.log(a)}},error:function(a){if(trace.enable){if(window.console&&console.error)window.console.error(a);else throw a;}},warn:function(a){if(trace.enable){if(window.console&&console.warn)window.console.warn(a);else window.trace("[警告]"+a)}},info:function(a){if(trace.enable){if(window.console&&console.info)window.console.info(a);else window.trace.write("[信息]"+a)}},dir:function(a){if(trace.enable){if(window.console&&console.dir)window.console.dir(a);else if(a){var r="",i;for(i in a)r+=i+" = "+trace.inspect(a[i],1)+"\r\n";window.trace(r)}}},clear:function(){if(window.console&&console.clear)window.console.clear()},eval:function(a){if(trace.enable){try{typeof a==='function'?a():eval(a)}catch(e){return e}}return""},time:function(a){var b=0,currentTime,start=+new Date(),past;try{do{b+=10;currentTime=10;while(--currentTime>0){a()}past=+new Date()-start}while(past<100)}catch(e){}window.trace("[时间] "+past/b)}});extend(assert,{stackTrace:true,debugStepThrough:true,deprected:function(a){},isFunction:createAssertFunc(function(a){return typeof a=='function'},"必须是函数。"),isArray:createAssertFunc(function(a){return typeof a.length=='number'},"必须是数组。"),isNumber:createAssertFunc(function(a){return typeof a==="number"||a instanceof Number},"必须是数字。"),isString:createAssertFunc(function(a){return typeof a==="string"||a instanceof String},"必须是字符串。"),isDate:createAssertFunc(function(a){return a&&a instanceof Date},"必须是日期对象。"),isRegExp:createAssertFunc(function(a){return a&&a instanceof RegExp},"必须是正则表达式。"),isObject:createAssertFunc(function(a){return a&&(typeof a==="object"||typeof a==="function"||typeof a.nodeType==="number")},"必须是一个引用对象。"),isNode:createAssertFunc(function(a){return a?typeof a.nodeType==="number"||a.setTimeout:a===null},"必须是 DOM 节点。"),isElement:createAssertFunc(function(a){return a?typeof a.nodeType==="number"&&a.style:a===null},"必须是 DOM 元素。"),notNull:createAssertFunc(function(a){return a!=null},"不可为空。")});function createAssertFunc(c,d){var e=function(a,b){return assert(c(a),(b||"断言失败。").replace('~',d),a)};e.debugStepThrough=true;return e}extend(using,{loadScript:function(a){var b=using.loadText(a);if(b){try{if(window.execScript){window.execScript(b)}else{window["eval"].call(window,b)}}catch(e){}}},loadStyle:function(a){return document.getElementsByTagName("HEAD")[0].appendChild(extend(document.createElement('link'),{href:a,rel:'stylesheet',type:'text/css'}))},loadText:function(a){var b=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),status;try{b.open("GET",a,false);b.send(null);status=b.status;if((status>=200&&status<300)||status==304||status==1223){return b.responseText}else{throw"服务器返回状态码 "+status;}}catch(e){}finally{b=null}},styles:[],scripts:[],rootPath:(function(){try{var a=document.getElementsByTagName("script");a=a[a.length-1];a=!document.constructor?a.getAttribute('src',4):a.src;return(a.match(/([\S\s]*\/)System\/Core\/assets\/scripts\//)||[0,""])[1]}catch(e){return""}})(),resolve:function(a,b){return a.replace(/^([^.]+\.[^.]+)\./,b?'$1.assets.styles.':'$1.assets.scripts.').replace(/\./g,'/')}});function extend(a,c){assert(a!=null,"Object.extend(dest, src): {dest} 不可为空。",a);for(var b in c)a[b]=c[b];return a}})();(function(h){assert(!h.Dom||h.$!==h.Dom.get,"重复引入 System.Dom.Base 模块。");var k=h.document,Object=h.Object,extend=Object.extend,ap=Array.prototype,map=Object.map,isStd=navigator.isStd,Dom=Class({node:null,dataField:function(){return this.node.$data||(this.node.$data={})},constructor:function(a){assert.isNode(a,"Dom#constructor(node): {node} 必须是 DOM 节点。");this.node=a},attach:function(a,b){assert(a&&a.nodeType,'Dom#attach(parentNode, refNode): {parentNode} 必须是 DOM 节点。',a);assert(b===null||b.nodeType,'Dom#attach(parentNode, refNode): {refNode} 必须是 null 或 DOM 节点 。',b);a.insertBefore(this.node,b)},detach:function(a){assert(a&&a.removeChild,'Dom#detach(parentNode): {parentNode} 必须是 DOM 节点 Dom 对象。',parent);if(this.node.parentNode===a)a.removeChild(this.node)},insertBefore:function(a,b){assert(a&&a.attach,'Dom#insertBefore(childControl, refControl): {childControl} 必须 Dom 对象。',a);a.attach(this.node,b&&b.node||null);return a},removeChild:function(a){assert(a&&a.detach,'Dom#removeChild(childControl): {childControl} 必须 Dom 对象。',a);a.detach(this.node);return a},equals:function(a){return this.node===a||(a&&this.node===a.node)}}),DomList=Class({length:0,constructor:function(a){if(a){var b;while(b=a[this.length]){this[this.length++]=Dom.getNode(b)}}},item:function(a){var b=this[a<0?this.length+a:a];return b?new Dom(b):null},invoke:function(b,c){c=c||[];var r=[];assert(dp[b]&&dp[b].apply,"DomList#invoke(fnName): {fnName} 不是 Dom 对象的方法。",b);this.forEach(function(a){a=new Dom(a);r.push(a[b].apply(a,c))});return r},concat:function(){assert.deprected('DomList#concat 已过时，请改用 DomList#add');return this.add.apply(this,arguments)},add:function(){for(var a=arguments,i=0,value;i<a.length;i++){value=a[i],j=-1;if(value){if(typeof value.length!=='number')value=[value];while(++j<value.length)this.include(Dom.getNode(value[j]))}}return this},filter:function(b){return new DomList(ap.filter.call(this,typeof b==='string'?function(a){return Dom.match(a,b)}:b))},on:createDomListMthod('on'),un:createDomListMthod('un'),trigger:function(a,e){return this.invoke('trigger',[a,e]).indexOf(false)<0}}),Point=Class({constructor:function(x,y){this.x=x;this.y=y},add:function(p){assert(p&&'x'in p&&'y'in p,"Point#add(p): {p} 必须有 'x' 和 'y' 属性。",p);return new Point(this.x+p.x,this.y+p.y)},sub:function(p){assert(p&&'x'in p&&'y'in p,"Point#sub(p): {p} 必须有 'x' 和 'y' 属性。",p);return new Point(this.x-p.x,this.y-p.y)}}),DomEvent=Class({constructor:function(a,b){assert.notNull(a,"Dom.Event#constructor(target, type): {target} ~");this.target=a;this.type=b},stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},getTarget:function(){return new Dom(this.orignalType&&this.currentTarget||(this.target.nodeType===3?this.target.parentNode:this.target))}}),dp=Dom.prototype,ep=DomEvent.prototype,returnTrue=function(){return true},div=k.createElement('DIV'),cache={},defaultEvent={stopEvent:function(e){e.stopPropagation();e.preventDefault()},dispatch:function(a,b,c,e){a=a.node;var d=e;if(!e||!e.type){e=new Dom.Event(a,b);if(d){try{extend(e,d)}catch(ex){}}}return c(e)&&(!a[b='on'+b]||a[b](e)!==false)},add:div.addEventListener?function(a,b,c){a.node.addEventListener(b,c,false)}:function(a,b,c){a.node.attachEvent('on'+b,c)},remove:div.removeEventListener?function(a,b,c){a.node.removeEventListener(b,c,false)}:function(a,b,c){a.node.detachEvent('on'+b,c)}},mouseEvent=defaultEvent,keyEvent=defaultEvent,rXhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,rOpacity=/opacity=([^)]*)/,rStyle=/-(\w)|float/g,rBody=/^(?:BODY|HTML|#document)$/i,rCheckBox=/^(?:checkbox|radio)$/,defaultHook={getProp:function(a,b){return b in a?a[b]:null},setProp:function(a,b,c){if('238'.indexOf(a.nodeType)===-1){a[b]=c}},get:function(a,b){return a.getAttribute?a.getAttribute(b):this.getProp(a,b)},set:function(a,b,c){if(a.setAttribute){if(c===null){a.removeAttribute(b)}else{a.setAttribute(b,c)}}else{this.setProp(a,b,c)}}},propHook={get:function(a,b,c){return c||!(b in a)?defaultHook.get(a,b):a[b]},set:function(a,b,c){if(b in a){a[b]=c}else{defaultHook.set(a,b,c)}}},boolHook={get:function(a,b,c){var d=b in a?a[b]:defaultHook.get(a,b);return c?d?b.toLowerCase():null:!!d},set:function(a,b,c){a[b]=c}},formHook={get:function(a,b,c){var d=defaultHook.get(a,b);if(!c&&!d){if(a[b].nodeType){a=Dom.createNode('form')}d=a[b]}return d},set:defaultHook.set},parseFix={$default:isStd?[1,'','']:[2,'$<div>','</div>'],option:[2,'<select multiple="multiple">','</select>'],legend:[2,'<fieldset>','</fieldset>'],thead:[2,'<table>','</table>'],tr:[3,'<table><tbody>','</tbody></table>'],td:[4,'<table><tbody><tr>','</tr></tbody></table>'],col:[3,'<table><tbody></tbody><colgroup>','</colgroup></table>'],area:[2,'<map>','</map>']},styleFix={height:function(a){this.node.style.height=a>0?a+'px':a<=0?'0px':a;return this},width:function(a){this.node.style.width=a>0?a+'px':a<=0?'0px':a;return this}},propFix={innerText:'innerText'in div?'innerText':'textContent'},attrFix={maxLength:{get:propHook.get,set:function(a,b,c){if(c||c===0){a[b]=c}else{defaultHook.set(a,b,null)}}},selected:{get:function(a,b,c){var d=a.parentNode;if(d){d.selectedIndex;if(d.parentNode){d.parentNode.selectedIndex}}return b in a?c?(c===1?a[b]:a.defaultSelected)?b:null:a[b]:defaultHook.get(a,b)},set:boolHook.set},checked:{get:function(a,b,c){return b in a?c?(c===1?a[b]:a.defaultChecked)?b:null:a[b]:defaultHook.get(a,b)},set:boolHook.set},value:{get:function(a,b,c){return b in a?c!==2?a[b]:a.defaultValue:defaultHook.get(a,b)},set:propHook.set},tabIndex:{get:function(a,b,c){var d=a.getAttributeNode(b);d=d&&d.specified&&d.value||null;return c?d:+d},set:propHook.set}},textFix={},getStyle=h.getComputedStyle?function(a,b){assert.isElement(a,"Dom.getStyle(elem, name): {elem} ~");var c=a.ownerDocument.defaultView.getComputedStyle(a,null);return c?c[b]:null}:function(a,b){assert.isElement(a,"Dom.getStyle(elem, name): {elem} ~");if(b in styleFix){switch(b){case'height':return a.offsetHeight===0?'auto':a.offsetHeight-Dom.calc(a,'by+py')+'px';case'width':return a.offsetWidth===0?'auto':a.offsetWidth-Dom.calc(a,'bx+px')+'px';case'opacity':return rOpacity.test(styleString(a,'filter'))?parseInt(RegExp.$1)/100+'':'1'}}var r=a.currentStyle;if(!r)return"";r=r[b];if(/^-?\d/.test(r)&&!/^-?\d+(?:px)?$/i.test(r)){var c=a.style,left=c.left,rsLeft=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;c.left=b==="fontSize"?"1em":(r||0);r=c.pixelLeft+"px";c.left=left;a.runtimeStyle.left=rsLeft}return r},styleFloat='cssFloat'in div.style?'cssFloat':'styleFloat',domReady,t;parseFix.optgroup=parseFix.option;parseFix.tbody=parseFix.tfoot=parseFix.colgroup=parseFix.caption=parseFix.thead;parseFix.th=parseFix.td;map("enctype encoding action method target",formHook,attrFix);map("defaultChecked defaultSelected readOnly disabled autofocus autoplay async controls hidden loop open required scoped compact noWrap isMap declare noshade multiple noresize defer useMap",boolHook,attrFix);map("readOnly tabIndex defaultChecked defaultSelected accessKey useMap contentEditable maxLength",function(a){propFix[a.toLowerCase()]=a});map("innerHTML innerText textContent tagName nodeName nodeType nodeValue defaultValue selectedIndex cellPadding cellSpacing rowSpan colSpan frameBorder",function(a){propFix[a.toLowerCase()]=a;attrFix[a]=propHook});textFix.INPUT=textFix.SELECT=textFix.TEXTAREA='value';textFix['#text']=textFix['#comment']='nodeValue';extend(Dom,{get:function(a){return typeof a==="string"?(a=k.getElementById(a))&&new Dom(a):a?a.nodeType||a.setTimeout?new Dom(a):a.node?new Dom(a.node):Dom.get(a[0]):null},find:function(a){return typeof a==="string"?k.find(a):Dom.get(a)},query:function(a){return a?typeof a==='string'?k.query(a):a.nodeType||a.setTimeout?new DomList([a]):typeof a.length==='number'?a instanceof DomList?a:new DomList(a):new DomList([Dom.getNode(a)]):new DomList},parse:function(a,b,c){return(a=Dom.parseNode(a,b,c))?a.nodeType?new Dom(a):a:null},create:function(a,b){return new Dom(Dom.createNode(a,b||''))},getNode:function(a){return a?a.nodeType||a.setTimeout?a:a.node||(typeof a==="string"?k.getElementById(a):Dom.getNode(a[0])):null},createNode:function(a,b){assert.isString(a,'Dom.create(tagName, className): {tagName} ~');var c=k.createElement(a);c.className=b;return c},parseNode:function(b,c,d){if(typeof b==='string'){var e=b;d=d!==false&&e.length<512;c=c&&c.ownerDocument||k;assert(c.createElement,'Dom.parseNode(html, context, cachable): {context} 必须是 DOM 节点。',c);if(d&&(b=cache[e])&&b.ownerDocument===c){b=b.cloneNode(true)}else{var f=/<([!\w:]+)/.exec(e);if(f){assert.isString(e,'Dom.parseNode(html, context, cachable): {html} ~');b=c.createElement("div");var g=parseFix[f[1].toLowerCase()]||parseFix.$default;b.innerHTML=g[1]+e.trim().replace(rXhtmlTag,"<$1></$2>")+g[2];if(navigator.isQuirks){each(b.getElementsByTagName('INPUT'),function(a){if(rCheckBox.test(a.type)){a.checked=a.defaultChecked}})}for(f=g[0];f--;)b=b.lastChild;assert.isNode(b,"Dom.parseNode(html, context, cachable): 无法根据 {html} 创建节点。",e);if(b.previousSibling){g=b.parentNode;b=new DomList();for(e=g.firstChild;e;e=e.nextSibling){b.push(e)}d=false}else{b.parentNode.removeChild(b)}d=d&&!/<(?:script|object|embed|option|style)/i.test(e)}else{b=c.createTextNode(e)}if(d){cache[e]=b.cloneNode(true)}}}return b},match:function(a,b){assert.isString(b,"Dom#find(selector): selector ~。");if(a.nodeType!==1)return false;if(!a.parentNode){var c=k.createElement('div');c.appendChild(a);try{return match(a,b)}finally{c.removeChild(a)}}return match(a,b)},has:div.compareDocumentPosition?function(a,b){assert.isNode(a,"Dom.has(elem, child): {elem} ~");assert.isNode(b,"Dom.has(elem, child): {child} ~");return!!(b&&(a.compareDocumentPosition(b)&16))}:function(a,b){assert.isNode(a,"Dom.has(elem, child): {elem} ~");assert.isNode(b,"Dom.has(elem, child): {child} ~");if(b){while(b=b.parentNode)if(a===b)return true}return false},getText:function(a){assert.isNode(a,"Dom.getText(elem, name): {elem} ~");return a[textFix[a.nodeName]||propFix.innerText]||''},getAttr:function(a,b,c){assert.isNode(a,"Dom.getAttr(elem, name): {elem} ~");b=propFix[b]||b;var d=attrFix[b];return d?d.get(a,b,c):defaultHook.get(a,b.toLowerCase(),c)},hasClass:function(a,b){assert.isNode(a,"Dom.hasClass(elem, className): {elem} ~");assert(b&&(!b.indexOf||!/[\s\r\n]/.test(b)),"Dom.hasClass(elem, className): {className} 不能空，且不允许有空格和换行。如果需要判断 2 个 class 同时存在，可以调用两次本函数： if(hasClass('A') && hasClass('B')) ...");return(" "+a.className+" ").indexOf(" "+b+" ")>=0},$event:{},cloneFix:{INPUT:function(a,b){if(rCheckBox.test(a.type)){b.defaultChecked=b.checked=a.checked;if(b.value!==a.value){b.value=a.value}}else{b.value=a.value}},TEXTAREA:'value',OPTION:'selected',OBJECT:function(a,b){if(a.parentNode){a.outerHTML=b.outerHTML;if(b.innerHTML&&!a.innerHTML)a.innerHTML=b.innerHTML}}},attrFix:attrFix,propFix:propFix,textFix:textFix,styleFix:styleFix,pseudos:{target:function(a){var b=a.id||a.name;if(!b)return false;var c=getDocument(a).defaultView;return b===(c.defaultView||c.parentWindow).location.hash.slice(1)},empty:Dom.isEmpty=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType===1||a.nodeType===3)return false;return true},contains:function(a,b){return Dom.getText(a).indexOf(b)>=0},hidden:Dom.isHidden=function(a){return(a.style.display||getStyle(a,'display'))==='none'},visible:function(a){return!Dom.isHidden(a)},not:function(a,b){return!match(a,b)},has:function(a,b){return query(b,new Dom(a)).length>0},selected:function(a){return attrFix.selected.get(a,'selected',1)},checked:function(a){return a.checked},enabled:function(a){return a.disabled===false},disabled:function(a){return a.disabled===true},input:function(a){return/^(input|select|textarea|button)$/i.test(a.nodeName)},"nth-child":function(a,b,c){var t=Dom.pseudos;if(t[a]){t[a](null,b,c)}else if(a=b[a-1])c.push(a)},"first-child":function(a,b,c){if(a=b[0])c.push(a)},"last-child":function(a,b,c){if(a=b[b.length-1])c.push(a)},"only-child":function(a){var p=new Dom(a.parentNode).first(a.nodeName);return p&&p.next()},odd:function(a,b,c){var d=0,elem,t;while(elem=b[d++]){if(a){c.push(elem)}}},even:function(a,b,c){return Dom.pseudos.odd(!a,b,c)}},displayFix:{position:"absolute",visibility:"visible",display:"block"},styleNumbers:map('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom',returnTrue,{}),window:new Dom(h),document:new Dom(k),getStyle:getStyle,styleString:styleString,styleNumber:styleNumber,defaultDisplay:function(a){var b=Dom.displays||(Dom.displays={}),tagName=a.tagName,display=b[tagName],iframe,iframeDoc;if(!display){a=k.createElement(tagName);k.body.appendChild(a);display=getStyle(a,'display');k.body.removeChild(a);if(display==="none"||display===""){iframe=k.body.appendChild(Dom.emptyIframe||(Dom.emptyIframe=Object.extend(k.createElement("iframe"),{frameBorder:0,width:0,height:0})));iframeDoc=(iframe.contentWindow||iframe.contentDocument).document;iframeDoc.write("<!doctype html><html><body>");iframeDoc.close();a=iframeDoc.body.appendChild(iframeDoc.createElement(tagName));display=getStyle(a,'display');k.body.removeChild(iframe)}b[tagName]=display}return display},show:function(a){assert.isElement(a,"Dom.show(elem): {elem} ~");a.style.display='';if(getStyle(a,'display')==='none')a.style.display=a.style.defaultDisplay||Dom.defaultDisplay(a)},hide:function(a){assert.isElement(a,"Dom.hide(elem): {elem} ~");var b=styleString(a,'display');if(b!=='none'){a.style.defaultDisplay=b;a.style.display='none'}},calc:(function(){var c={},init,tpl;if(h.getComputedStyle){init='var c=e.ownerDocument.defaultView.getComputedStyle(e,null);return ';tpl='(parseFloat(c["#"])||0)'}else{init='return ';tpl='(parseFloat(Dom.getStyle(e, "#"))||0)'}function format(a){if(a.length===2){var t=a.charAt(0),d=a.charAt(1),ns1={m:'margin#',b:'border#Width',p:'padding#'},ns2={t:'Top',r:'Right',b:'Bottom',l:'Left'};if(t in ns1){t=ns1[t];if(d=='x'){a='('+t.replace('#',ns2.l)+'+'+t.replace('#',ns2.r)+')'}else if(d=='y'){a='('+t.replace('#',ns2.t)+'+'+t.replace('#',ns2.b)+')'}else{a=t.replace('#',ns2[d])}}else if(t=='s'){return d=='x'?'e.offsetWidth':'e.offsetHeight'}}else if(a=='width'||a=='height'){return'Dom.styleNumber(e,"'+a+'")'}else if(a.length<2){return a}return tpl.replace('#',a)}return function(a,b){assert.isElement(a,"Dom.calc(elem, type): {elem} ~");assert.isString(b,"Dom.calc(elem, type): {type} ~");return(c[b]||(c[b]=new Function("e",init+b.replace(/\w+/g,format))))(a)}})(),movable:function(a){assert.isElement(a,"Dom.movable(elem): 参数 elem ~");if(!/^(?:abs|fix)/.test(styleString(a,"position")))a.style.position="relative"},getDocument:getDocument,implement:function(a,b,c){var d=[DomList,Dom],i;for(var e in a){i=d.length;while(i--){if(!c||!d[i].prototype[e]){d[i].prototype[e]=i?a[e]:createDomListMthod(e,b)}}}return this},implementIf:function(a,b){return this.implement(a,b,true)},Event:DomEvent}).implement({appendTo:function(a){a?(a.append?a:Dom.get(a)).append(this):this.attach(k.body,null);return this},remove:function(a){assert(!arguments.length||a,'Dom#remove(child): {child} 不是合法的节点',a);return arguments.length?typeof a==='string'?this.query(a).remove():this.removeChild(a):(a=this.parentControl||this.parent())?a.removeChild(this):this},empty:function(){var a=this.node;while(a=this.last(null))this.removeChild(a);return this},dispose:function(){var a=this.node;if(a.nodeType==1){each(a.getElementsByTagName("*"),clean);clean(a)}return this.remove()},setStyle:function(a,b){var c=this;assert.isString(a,"Dom#setStyle(name, value): {name} ~");assert.isElement(c.node,"Dom#setStyle(name, value): 当前 dom 不支持样式");if(arguments.length==1){c.node.style.cssText+=';'+a}else if(a in styleFix){return styleFix[a].call(c,b)}else{a=a.replace(rStyle,formatStyle);assert(b||!isNaN(b),"Dom#setStyle(name, value): {value} 不是正确的属性值。",b);if(typeof b==="number"&&!(a in Dom.styleNumbers))b+="px"}c.node.style[a]=b;return c},show:function(){Dom.show(this.node);return this},hide:function(a,b){Dom.hide(this.node);return this},toggle:function(){var a=arguments,flag=a[a.length-1];return this[(typeof flag==='boolean'?flag:Dom.isHidden(this.node))?'show':'hide'].apply(this,a)},unselectable:'unselectable'in div?function(a){assert.isElement(this.node,"Dom#unselectable(value): 当前 dom 不支持此操作");this.node.unselectable=a!==false?'on':'';return this}:'onselectstart'in div?function(a){assert.isElement(this.node,"Dom#unselectable(value): 当前 dom 不支持此操作");this.node.onselectstart=a!==false?function(){return false}:null;return this}:function(a){assert.isElement(this.node,"Dom#unselectable(value): 当前 dom 不支持此操作");this.node.style.MozUserSelect=a!==false?'none':'';return this},setAttr:function(a,b){var c=this.node;a=propFix[a]||a;var d=attrFix[a];if(!d){d=defaultHook;a=a.toLowerCase()}d.set(c,a,b);return this},set:function(a,b){var c=this,key,setter;if(typeof a==='string'){key=a;a={};a[key]=b}for(key in a){b=a[key];if(c.node.style&&(key in c.node.style||rStyle.test(key)))c.setStyle(key,b);else if(typeof c[setter='set'+key.capitalize()]==='function')c[setter](b);else if(key in c){setter=c[key];if(typeof setter==='function')c[key](b);else if(setter&&setter.set)setter.set(b);else c[key]=b}else if(/^on(\w+)/.test(key))b&&c.on(RegExp.$1,b);else c.setAttr(key,b)}return c},addClass:function(a){assert.isString(a,"Dom#addClass(className): {className} ~");var b=this.node,classList=a.split(/\s+/),newClass,i;if(!b.className&&classList.length<=1){b.className=a}else{newClass=" "+b.className+" ";for(i=0;i<classList.length;i++){if(newClass.indexOf(" "+classList[i]+" ")<0){newClass+=classList[i]+" "}}b.className=newClass.trim()}return this},removeClass:function(a){assert(!a||a.split,"Dom#removeClass(className): {className} ~");var b=this.node,classList,newClass="",i;if(a){classList=a.split(/\s+/);newClass=" "+b.className+" ";for(i=classList.length;i--;){newClass=newClass.replace(" "+classList[i]+" "," ")}newClass=newClass.trim()}b.className=newClass;return this},toggleClass:function(a,b){return this[(b==undefined?this.hasClass(a):!b)?'removeClass':'addClass'](a)},setText:function(a){this.node[textFix[this.node.nodeName]||propFix.innerText]=a;return this},setHtml:function(a){if(/<(?:script|style)/i.test(a)){this.empty().append(a);return this}var b=this.node,map=parseFix.$default;assert(b.nodeType===1,"Dom#setHtml(value): {elem} 不是元素节点(nodeType === 1), 无法执行 setHtml。",b);try{b.innerHTML=(map[1]+a+map[2]).replace(rXhtmlTag,"<$1></$2>")}catch(e){this.empty().append(a);return this}if(map[0]>1){a=b.lastChild;b.removeChild(b.firstChild);b.removeChild(a);while(a.firstChild)b.appendChild(a.firstChild)}return this},setSize:function(x,y){var a=this,p=formatPoint(x,y);if(p.x!=null)a.setWidth(p.x-Dom.calc(a.node,'bx+px'));if(p.y!=null)a.setHeight(p.y-Dom.calc(a.node,'by+py'));return a},setWidth:styleFix.width,setHeight:styleFix.height,setOffset:function(a){assert(a,"Dom#setOffset(offsetPoint): {offsetPoint} 必须有 'x' 和 'y' 属性。",a);var b=this.node.style;if(a.y!=null)b.top=a.y+'px';if(a.x!=null)b.left=a.x+'px';return this},setPosition:function(x,y){Dom.movable(this.node);var a=this,currentPosition=a.getPosition(),offset=a.getOffset(),newPosition=formatPoint(x,y);if(newPosition.y!=null)offset.y+=newPosition.y-currentPosition.y;else offset.y=null;if(newPosition.x!=null)offset.x+=newPosition.x-currentPosition.x;else offset.x=null;return a.setOffset(offset)},setScroll:function(x,y){var a=this.node,offsetPoint=formatPoint(x,y);if(a.nodeType!==9){if(offsetPoint.x!=null)a.scrollLeft=offsetPoint.x;if(offsetPoint.y!=null)a.scrollTop=offsetPoint.y}else{if(offsetPoint.x==null)offsetPoint.x=this.getScroll().x;if(offsetPoint.y==null)offsetPoint.y=this.getScroll().y;(a.defaultView||a.parentWindow).scrollTo(offsetPoint.x,offsetPoint.y)}return this},bind:function(a,b){var c,selector;if(typeof a==='string'){c=(/^\w+/.exec(a)||[''])[0];assert(c,"Dom#bind(eventAndSelector, handler): {eventAndSelector} 中不存在事件信息。正确的 eventAndSelector 格式： click.selector")if(selector=a.substr(c.length)){this.delegate(selector,c,b)}else{this.on(c,b)}}else{for(c in a){this.bind(c,a[c])}}return this},submit:function(){var e=new Dom.Event(this.node,'submit');this.trigger('submit',e);if(e.returnValue!==false){this.node.submit()}return this},delegate:function(b,c,d){assert.isString(b,"Dom#delegate(selector, eventName, handler): {selector}  ~");assert.isString(c,"Dom#delegate(selector, eventName, handler): {eventName}  ~");assert.isFunction(d,"Dom#delegate(selector, eventName, handler): {handler}  ~");var f='delegate:'+c,delegateEvent,eventInfo=Dom.$event[c],initEvent,data=this.dataField();if(eventInfo&&eventInfo.delegate){c=eventInfo.delegate;initEvent=eventInfo.initEvent}data=data.$event||(data.$event={});delegateEvent=data[f];if(!delegateEvent){data[f]=delegateEvent=function(e){var a=e.getTarget(),delegateHandlers=arguments.callee.handlers,actucalHandlers=[],i,handlerInfo,delegateTarget;for(i=0;i<delegateHandlers.length;i++){handlerInfo=delegateHandlers[i];if((delegateTarget=a.closest(handlerInfo[1]))&&(!initEvent||initEvent.call(delegateTarget,e)!==false)){actucalHandlers.push([handlerInfo[0],delegateTarget])}}for(i=0;i<actucalHandlers.length;i++){handlerInfo=actucalHandlers[i];if(handlerInfo[0].call(handlerInfo[1],e)===false){e.stopPropagation();e.preventDefault();break}}};this.on(c,delegateEvent);delegateEvent.handlers=[]}delegateEvent.handlers.push([d,b]);return this}}).implement({getStyle:function(a){var b=this.node;assert.isString(a,"Dom#getStyle(name): {name} ~");assert(b.style,"Dom#getStyle(name): 当 Dom 对象对应的节点不是元素，无法使用样式。");return b.style[a=a.replace(rStyle,formatStyle)]||getStyle(b,a)},getAttr:function(a,b){return Dom.getAttr(this.node,a,b)},getText:function(){return Dom.getText(this.node)},getHtml:function(){assert(this.node.nodeType===1,"Dom#getHtml(): 仅当 dom.nodeType === 1 时才能使用此函数。");return this.node.innerHTML},getSize:function(){var a=this.node,x,y;if(a.nodeType!==9){x=a.offsetWidth;y=a.offsetHeight}else{a=a.documentElement;x=a.clientWidth;y=a.clientHeight}return new Point(x,y)},getWidth:function(){return styleNumber(this.node,'width')},getHeight:function(){return styleNumber(this.node,'height')},getScrollSize:function(){var a=this.node,x,y;if(a.nodeType!==9){x=a.scrollWidth;y=a.scrollHeight}else{var b=a.body;a=a.documentElement;x=Math.max(a.scrollWidth,b.scrollWidth,a.clientWidth);y=Math.max(a.scrollHeight,b.scrollHeight,a.clientHeight)}return new Point(x,y)},getOffset:function(){var a=this.node,left=styleString(a,'left'),top=styleString(a,'top');if((!left||!top||left==='auto'||top==='auto')&&styleString(a,"position")==='absolute'){top=this.offsetParent();left=this.getPosition();if(!rBody.test(top.node.nodeName))left=left.sub(top.getPosition());left.x-=styleNumber(a,'marginLeft')+styleNumber(top.node,'borderLeftWidth');left.y-=styleNumber(a,'marginTop')+styleNumber(top.node,'borderTopWidth');return left}return new Point(parseFloat(left)||0,parseFloat(top)||0)},getPosition:function(){if(this.node.nodeType===9){return this.getScroll()}var a=this.node,bound=typeof a.getBoundingClientRect!=="undefined"?a.getBoundingClientRect():{x:0,y:0},doc=getDocument(a),html=doc.documentElement,htmlScroll=doc.getScroll();return new Point(bound.left+htmlScroll.x-html.clientLeft,bound.top+htmlScroll.y-html.clientTop)},getScroll:function(){var a=this.node,win,x,y;if(a.nodeType!==9){x=a.scrollLeft;y=a.scrollTop}else if('pageXOffset'in(win=a.defaultView||a.parentWindow)){x=win.pageXOffset;y=win.pageYOffset}else{a=a.documentElement;x=a.scrollLeft;y=a.scrollTop}return new Point(x,y)},index:function(a){var i=0,elem=this.node;while(elem=elem.previousSibling)if(elem.nodeType===1||a===true)i++;return i},child:function(a){var b='firstChild',next='nextSibling',isNumber=typeof a==='number';if(a<0){a=~a;b='lastChild';next='previousSibling'}b=this.node[b];while(b){if(b.nodeType===1&&(isNumber?a--<=0:quickMatch(b,a))){return new Dom(b)}b=b[next]}return null},parent:createTreeWalker('parentNode'),closest:function(a,b){var c=this.node;while(c){if(quickMatch(c,a)){return(!b||Dom.get(b).has(c))?new Dom(c):null}c=c.parentNode}return null},first:createTreeWalker('nextSibling','firstChild'),last:createTreeWalker('previousSibling','lastChild'),next:createTreeWalker('nextSibling'),prev:createTreeWalker('previousSibling'),children:createTreeDir('nextSibling','firstChild'),nextAll:createTreeDir('nextSibling'),prevAll:createTreeDir('previousSibling'),parentAll:createTreeDir('parentNode'),siblings:function(a){return this.prevAll(a).add(this.nextAll(a))},offsetParent:function(){var a=this.node;while((a=a.offsetParent)&&!rBody.test(a.nodeName)&&styleString(a,"position")==="static");return new Dom(a||getDocument(this.node).body)}},2).implement({getElements:function(a){var b='getElementsByTagName';var c=this[b]?this:this.node;a=a||"*";if(c[b]){return c[b](a)}b='querySelectorAll';if(c[b]){return c[b](a)}return[]},query:function(a){assert.isString(a,"Dom#find(selector): selector ~。");assert(a,"Dom#find(selector): {selector} 不能为空。",a);var b=this.node,result;if(b.nodeType!==1){return k.query.call(this,a)}try{var c=b.id,displayId=c;if(!c){b.id=displayId='__SELECTOR__';c=0}result=b.querySelectorAll('#'+displayId+' '+a)}catch(e){result=query(a,this)}finally{if(c===0){b.removeAttribute('id')}}return new DomList(result)},clone:function(a,b,c){var d=this.node,clone=d.cloneNode(a=a!==false);if(d.nodeType===1){if(a){for(var e=d.getElementsByTagName('*'),cloneChild=clone.getElementsByTagName('*'),i=0;cloneChild[i];i++)cleanClone(e[i],cloneChild[i],b,c)}cleanClone(d,clone,b,c)}return new this.constructor(clone)}},3).implement({find:function(a){assert.isString(a,"Dom#find(selector): selector ~");var b=this.node,result;if(b.nodeType!==1){return k.find.call(this,a)}try{var c=b.id,displayId=c;if(!c){b.id=displayId='__SELECTOR__';c=0}result=b.querySelector('#'+displayId+' '+a)}catch(e){result=query(a,this)[0]}finally{if(c===0){b.removeAttribute('id')}}return result?new Dom(result):null},hasClass:function(a){return Dom.hasClass(this.node,a)},match:function(a){return Dom.match(this.node,a)},isHidden:function(){return Dom.isHidden(this.node)},has:function(a,b){if(typeof a==="string")return(b&&this.match(a))||!!this.find(a);a=Dom.getNode(a);return(b&&this.node===a)||Dom.has(this.node,a)}},4);Object.each({append:function(a,b){return a.insertBefore(b,null)},prepend:function(a,b){return a.insertBefore(b,a.first(null))},before:function(a,b){var p=a.parentControl||a.parent();return p?p.insertBefore(b,a):null},after:function(a,b){var p=a.parentControl||a.parent();return p?p.insertBefore(b,a.next(null)):null},replaceWith:function(a,b){var c;if(c=(a.parentControl||a.parent())){b=c.insertBefore(b,a);c.removeChild(a)}return b}},function(d,e){dp[e]=function(a){var b,i,script,t;if(a=Dom.parse(a,this)){if(a instanceof DomList){t=Dom.getDocument(this.node).createDocumentFragment();for(i=0;i<a.length;i++){t.appendChild(a[i])}t=new Dom(t);b=t.getElements('SCRIPT');if(!navigator.isStd){b=new DomList(b)}d(this,t)}else{t=a;if(t.node.tagName==='SCRIPT'){b=[t.node]}else{b=t.getElements('SCRIPT');if(!navigator.isStd){b=new DomList(b)}}a=d(this,t)}i=0;while(script=b[i++]){if(!script.type||/\/(java|ecma)script/i.test(script.type)){if(script.src){assert(h.Ajax&&Ajax.send,"必须载入 System.Ajax.Script 模块以支持动态执行 <script src=''>");Ajax.send({url:script.src,type:"GET",dataType:'script',async:false})}else{h.execScript(script.text||script.textContent||script.innerHTML||"")}}}}return a};DomList.prototype[e]=function(c){var r;if(typeof c==='string'){r=new DomList(this.invoke(e,[c]))}else{r=new DomList;c=Dom.get(c);this.forEach(function(a){var b=c.clone();Dom.get(a)[e](b);r.push(b.node)})}return r}});Dom.defineMethods('node','scrollIntoView focus blur select click reset',1);k.node=k;k.find=function(a){assert.isString(a,"Dom#find(selector): selector ~");var b;try{b=this.querySelector(a)}catch(e){b=query(a,this)[0]}return b?new Dom(b):null};k.query=function(a){assert.isString(a,"Dom#find(selector): selector ~。");var b;try{b=this.querySelectorAll(a)}catch(e){b=query(a,this)}return new DomList(b)};t=k.constructor;if(t){t.$event=Dom.$event;t.base=Dom.base}else{k.constructor=Dom}map('on un trigger once delegate dataField getElements getPosition getSize getScroll setScroll getScrollSize has',function(a){k[a]=dp[a]});map("slice splice reverse unique shift pop unshift push include indexOf each forEach",function(a,b){DomList.prototype[a]=b<4?function(){return new DomList(ap[a].apply(this,arguments))}:ap[a]});map("$default mousewheel blur focus scroll change select submit resize error load unload touchstart touchmove touchend hashchange",defaultEvent,Dom.$event);if(isStd){domReady='DOMContentLoaded';Event.prototype.getTarget=ep.getTarget}else{domReady='readystatechange';defaultEvent.initEvent=function(e){e.target=e.srcElement;e.getTarget=ep.getTarget;e.stopPropagation=ep.stopPropagation;e.preventDefault=ep.preventDefault};mouseEvent={initEvent:function(e){if(!e.getTarget){defaultEvent.initEvent(e);e.relatedTarget=e.fromElement===e.srcElement?e.toElement:e.fromElement;var a=getDocument(e.target).documentElement;e.pageX=e.clientX+(a.scrollLeft||0)-(a.clientLeft||0);e.pageY=e.clientY+(a.scrollTop||0)-(a.clientTop||0);e.layerX=e.x;e.layerY=e.y;e.which=e.button&1?1:e.button&2?3:e.button&4?2:0}}};keyEvent={initEvent:function(e){defaultEvent.initEvent(e);e.which=e.keyCode}};Dom.cloneFix.SCRIPT='text';styleFix.opacity=function(a){var b=this.node,style=b.style;assert(!+a||(a<=1&&a>=0),'Dom#setStyle("opacity", value): {value} 必须在 0~1 间。',a);assert.isElement(b,"Dom#setStyle(name, value): 当前 dom 不支持样式");if(a)a*=100;a=a||a===0?'opacity='+a:'';b=styleString(b,'filter');assert(!/alpha\([^)]*\)/i.test(b)||rOpacity.test(b),'Dom#setOpacity(value): 当前元素的 {filter} CSS属性存在不属于 alpha 的 opacity， 将导致 setOpacity 不能正常工作。',b);style.zoom=1;style.filter=rOpacity.test(b)?b.replace(rOpacity,a):(b+' alpha('+a+')');return this};defaultHook.get=function(a,b){if(!a.getAttributeNode){return defaultHook.getProp(a,b)}b=a.getAttributeNode(b);return b?b.value||(b.specified?"":null):null};defaultHook.set=formHook.set=function(a,b,c){if(a.getAttributeNode){var d=a.getAttributeNode(b);if(c===null){if(d){d.nodeValue='';a.removeAttributeNode(d)}}else if(d){d.nodeValue=c}else{a.setAttribute(b,c)}}else{defaultHook.setProp(a,b,c)}};attrFix.style={get:function(a,b){return a.style.cssText.toLowerCase()||null},set:function(a,b,c){a.style.cssText=c||''}};if(navigator.isQuirks){attrFix.value={_get:attrFix.value.get,get:function(a,b,c){return a.tagName==='BUTTON'?defaultHook.get(a,b):this._get(a,b,c)},set:function(a,b,c){if(a.tagName==='BUTTON'){defaultHook.set(a,b,c)}else{a.value=c||''}}};attrFix.href=attrFix.src=attrFix.useMap=attrFix.width=attrFix.height={get:function(a,b){return a.getAttribute(b,2)},set:function(a,b,c){a.setAttribute(b,c)}};attrFix.contentEditable={get:function(a,b){b=a.getAttributeNode(b);return b&&b.specified?b.value:null},set:function(a,b,c){if(c===null){a.removeAttributeNode(a.getAttributeNode(b))}else{defaultHook.set(a,b,c||"false")}}};try{k.execCommand("BackgroundImageCache",false,true)}catch(e){}}}Dom.addEvents("click dblclick mousedown mouseup mouseover mouseenter mousemove mouseleave mouseout contextmenu selectstart selectend",mouseEvent);Dom.addEvents("keydown keypress keyup",keyEvent);if(div.onfocusin===undefined){Dom.addEvents('focusin focusout',{fix:function(a,b,c){var d=b==='focusin'?'focus':'blur';var e=a.node.ownerDocument||a.node;e[c](d,this.handler,true)},handler:function(e){var a=e.orignalType=e.type==='focus'?'focusin':'focusout';var p=e.getTarget();while(p){if(!p.trigger(a,e)){return}p=p.parent()}k.trigger(a,e)},add:function(a,b,c){this.fix(a,b,'addEventListener')},remove:function(){this.fix(elem,type,'removeEventListener')}})}if(div.onmousewheel===undefined){Dom.addEvents('mousewheel',{base:'DOMMouseScroll'})}if(navigator.isFirefox){Dom.addEvents('click',{initEvent:function(e){return e.which===undefined||e.which===1}})}Object.each({'mouseenter':'mouseover','mouseleave':'mouseout'},function(b,c){Dom.addEvents(c,{initEvent:function(e){if(e.type!==c){var a=e.relatedTarget;e.orignalType=c;return this.node!==a&&!Dom.has(this.node,a)}},base:div.onmouseenter===null?null:b,delegate:b})});Dom.addEvents('focus',{delegate:'focusin'}).addEvents('blur',{delegate:'focusout'});Dom.$event.domready=Dom.$event.domload={};map('ready load',function(d,e){var f=e?'isLoaded':'isReady';d='dom'+d;return function(a,b){var c=typeof a==='function';if(Dom[f]){if(c)a.call(b)}else if(c){k.on(d,a,b)}else if(k.body){if(e){c=Dom.window;a=d;Dom.ready()}else{c=k;a=domReady}defaultEvent.remove(c,a,arguments.callee);Dom[f]=true;if(k.trigger(d,a)){k.un(d)}}else{setTimeout(arguments.callee,1)}return k}},Dom);if(k.readyState!=="complete"){defaultEvent.add(k,domReady,Dom.ready);defaultEvent.add(Dom.window,'load',Dom.load,false);if(!isStd){var l=false;try{l=h.frameElement==null&&k.documentElement}catch(e){}if(l&&l.doScroll){(function doScrollCheck(){if(Dom.isReady){return}try{l.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}Dom.ready()})()}}}else{setTimeout(Dom.load,1)}div=null;h.Dom=Dom;h.DomList=DomList;h.Point=Point;h.$=h.$||Dom.get;h.$$=h.$$||Dom.query;function createDomListMthod(b,c){return!c?function(){var i=0,len=this.length,target;while(i<len){target=new Dom(this[i++]);target[b].apply(target,arguments)}return this}:c===2?function(){if(this.length){var a=new Dom(this[0]);return a[b].apply(a,arguments)}}:c===3?function(){var r=new DomList;return r.add.apply(r,this.invoke(b,arguments))}:function(){var i=0,r,target;while(i<this.length&&!r){target=new Dom(this[i++]);r=target[b].apply(target,arguments)}return r}}function each(a,b){var i=0,node;while(node=a[i++]){b(node)}}function getDocument(a){assert.isNode(a,'Dom.getDocument(node): {node} ~',a);return a.ownerDocument||a.document||a}function quickMatch(a,b){return!b||(typeof b==='string'?/^(?:[-\w:]|[^\x00-\xa0]|\\.)+$/.test(b)?a.tagName===b.toUpperCase():Dom.match(a,b):b(a))}function createTreeWalker(c,d){d=d||c;return function(a){var b=this.node[d];if(a===null){return b?new Dom(b):b}while(b&&b.nodeType!==1){b=b[c]}if(b&&quickMatch(b,a)){return new Dom(b)}return null}}function createTreeDir(c,d){d=d||c;return function(a){var b=this.node[d],r=new DomList;while(b){if((b.nodeType===1&&quickMatch(b,a))||a===null)r.push(b);b=b[c]}return r}}function cleanClone(b,c,d,e){if(!e&&c.removeAttribute)c.removeAttribute('id');if(c.clearAttributes){c.clearAttributes();c.mergeAttributes(b);c.$data=null;if(b.options){each(b.options,function(a){c.options.seleced=a.seleced})}}if(d!==false&&(d=b.$data)){c.$data=d=extend({},d);var f=d.$event,dest;if(f){d.$event=null;dest=new Dom(c);for(d in f)f[d].handlers.forEach(function(a){dest.on(d,a[0],a[1].node===b?dest:a[1])})}}if(e=Dom.cloneFix[b.tagName]){if(typeof e==='string'){c[e]=b[e]}else{e(c,b)}}}function clean(a){if(a.clearAttributes)a.clearAttributes();new Dom(a).un();a.$data=null}function formatStyle(a,b){return b?b.toUpperCase():styleFloat}function styleString(a,b){assert.isElement(a,"Dom.styleString(elem, name): {elem} ~");return a.style[b]||getStyle(a,b)}function styleNumber(a,b){assert.isElement(a,"Dom.styleNumber(elem, name): {elem} ~");var c=parseFloat(a.style[b]);if(!c&&c!==0){c=parseFloat(getStyle(a,b));if(!c&&c!==0){if(b in styleFix){var d={};for(var e in Dom.displayFix){d[e]=a.style[e]}extend(a.style,Dom.displayFix);c=parseFloat(getStyle(a,b))||0;extend(a.style,d)}else{c=0}}}return c}function formatPoint(x,y){return x&&typeof x==='object'?x:{x:x,y:y}}function match(a,b){var r,i=0;try{r=a.parentNode.querySelectorAll(b)}catch(e){return query(b,new Dom(a.parentNode)).indexOf(a)>=0||query(b,Dom.document).indexOf(a)>=0}while(r[i])if(r[i++]===a)return true;return false}function query(a,b){var c=b,rBackslash=/\\/g,m,key,d,lastSelector,filterData;a=a.trim();while(a){lastSelector=a;if(m=/^(^|[#.])((?:[-\w\*]|[^\x00-\xa0]|\\.)+)/.exec(a)){if(!m[1]||(b[m[1]==='#'?'getElementById':'getElementsByClassName'])){a=RegExp.rightContext;switch(m[1]){case'#':b=b.getElementById(m[2]);b=b?[b]:null;break;case'.':b=b.getElementsByClassName(m[2]);break;default:b=b.getElements(m[2].replace(rBackslash,""));break}if(!a){return new DomList(b)}}else{b=b.getElements()}}else if(m=/^\s*([\s>+~<])\s*(\*|(?:[-\w*]|[^\x00-\xa0]|\\.)*)/.exec(a)){a=RegExp.rightContext;var d=m[2].replace(rBackslash,"");switch(m[1]){case' ':b=b.getElements(d);break;case'>':b=b.children(d);break;case'+':b=b.next(d);break;case'~':b=b.nextAll(d);break;case'<':b=b.parentAll(d);break;default:throwError(m[1]);}}else{b=b.getElements()}if(!(b instanceof DomList)){b=new DomList(b)}while(m=/^([#\.:]|\[\s*)((?:[-\w]|[^\x00-\xa0]|\\.)+)/.exec(a)){a=RegExp.rightContext;d=m[2].replace(rBackslash,"");switch(m[1]){case"#":filterData=["id","=",d];break;case".":filterData=["class","~=",d];break;case":":filterData=Dom.pseudos[d]||throwError(d);e=undefined;if(m=/^\(\s*("([^"]*)"|'([^']*)'|[^\(\)]*(\([^\(\)]*\))?)\s*\)/.exec(a)){a=RegExp.rightContext;e=m[3]||m[2]||m[1]}break;default:filterData=[d.toLowerCase()];if(m=/^\s*(?:(\S?=)\s*(?:(['"])(.*?)\2|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/.exec(a)){a=RegExp.rightContext;if(m[1]){filterData[1]=m[1];filterData[2]=m[3]||m[4];filterData[2]=filterData[2]?filterData[2].replace(/\\([0-9a-fA-F]{2,2})/g,function(x,y){return String.fromCharCode(parseInt(y,16))}).replace(rBackslash,""):""}}break}var e,oldResult=b,i=0,elem;b=new DomList();if(filterData.call){if(filterData.length===3){filterData(e,oldResult,b)}else{while(elem=oldResult[i++]){if(filterData(elem,e))b.push(elem)}}}else{while(elem=oldResult[i++]){var f=Dom.getAttr(elem,filterData[0],1),expectedVal=filterData[2],tmpResult;switch(filterData[1]){case undefined:tmpResult=f!=null;break;case'=':tmpResult=f===expectedVal;break;case'~=':tmpResult=(' '+f+' ').indexOf(' '+expectedVal+' ')>=0;break;case'!=':tmpResult=f!==expectedVal;break;case'|=':tmpResult=('-'+f+'-').indexOf('-'+expectedVal+'-')>=0;break;case'^=':tmpResult=f&&f.indexOf(expectedVal)===0;break;case'$=':tmpResult=f&&f.substr(f.length-expectedVal.length)===expectedVal;break;case'*=':tmpResult=f&&f.indexOf(expectedVal)>=0;break;default:throw'Not Support Operator : "'+filterData[1]+'"'}if(tmpResult){b.push(elem)}}}}if(m=/^\s*,\s*/.exec(a)){a=RegExp.rightContext;return b.add(query(a,c))}if(lastSelector.length===a.length){throwError(a);}}return b}function throwError(a){throw new SyntaxError('An invalid or illegal string was specified : "'+a+'"!');}})(this);var Deferrable=Class({chain:function(a,b){var c=[a,b];if(this._firstTask){this._lastTask[2]=c}else{this._firstTask=c}this._lastTask=c},progress:function(){var a=this._firstTask;this.isRunning=false;if(a){this._firstTask=a[2];a[0].run(a[1])}return this},defer:function(a,b){var c=this.isRunning;this.isRunning=true;if(!c)return false;switch(b){case undefined:break;case"abort":case"stop":case"skip":this[b]();this.isRunning=true;return false;case"replace":this.init(this.options=Object.extend(this.options,a));case"ignore":return true;default:assert(b==="wait","Deferred#defer(args, link): 成员 {link} 必须是 wait、abort、stop、ignore、replace 之一。",b)}this.chain(this,a);return true},wait:function(a){if(this.isRunning){this.stop()}this.defer=a.defer.bind(a);this.progress=a.progress.bind(a);return this},then:function(b,c){if(this.isRunning){this.chain({owner:this,run:function(a){if(b.call(this.owner,a)!==false)this.owner.progress()}},c)}else{b.call(this,c)}return this},delay:function(a){return this.run({duration:a})},pause:Function.empty,skip:function(){this.pause();this.progress();return this},abort:function(){this.pause();this._firstTask=this._lastTask=null;this.isRunning=false;return this},stop:function(){return this.abort()}});var Ajax=(function(){var ajaxLoc,ajaxLocParts,rUrl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,defaultAccepts=["*/"]+["*"],Ajax;try{ajaxLoc=location.href}catch(e){ajaxLoc=document.createElement("a");ajaxLoc.href="";ajaxLoc=ajaxLoc.href}ajaxLocParts=rUrl.exec(ajaxLoc.toLowerCase())||[];Ajax=Deferrable.extend({options:{url:ajaxLoc,timeout:-1},constructor:function(){},send:function(a,b){var c=this,parts;if(!c.defer(a,b)){a=Object.extend({owner:c,timeout:c.options.timeout},a);assert(!a.url||a.url.replace,"Ajax#run(xhrObject): {xhrObject.url} 必须是字符串。",a.url);a.url=a.url?a.url.replace(/#.*$/,""):c.options.url;a.data=a.data?typeof a.data!=='string'?Ajax.param(a.data):a.data:null;if(a.crossDomain==null){parts=rUrl.exec(a.url.toLowerCase());a.crossDomain=!!(parts&&(parts[1]!=ajaxLocParts[1]||parts[2]!=ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))))}(Ajax.transports[a.dataType]||Ajax.transports.text)(a)}return c},pause:function(){if(this.callback)this.callback('Aborted',-3);return this}});Object.extend(Ajax,{send:function(a){return new Ajax().send(a)},transports:{},accepts:{},dataParsers:{},param:function(c,d){var s;if(c&&typeof c==='object'){s=[];Object.each(c,function(a,b){s.push(Ajax.param(a,d?d+"["+b+"]":b))});s=s.join('&')}else{s=encodeURIComponent(d)+"="+encodeURIComponent(c)}return s.replace(/%20/g,'+')},concatUrl:function(a,b){return b?a+(a.indexOf('?')>=0?'&':'?')+b:a},addCachePostfix:function(b){return/[?&]_=/.test(url)?url:Ajax.concatUrl(url,'_='+Date.now()+JPlus.id++);},checkStatus:function(status){if(!status){var protocol=window.location.protocol;return(protocol=="file: "||protocol=="chrome: "||protocol=="app: ");}return(status>=200&&status<300)||status==304||status==1223;},createNativeRequest:window.ActiveXObject?function(){return new ActiveXObject("Microsoft.XMLHTTP");}:function(){return new XMLHttpRequest();},done:function(xhrObject,error,status,statusText,eventArgs,done){var eventName;if(error){xhrObject.errorMessage=eventArgs;eventName='error';}else{try{eventArgs=eventArgs.call(Ajax.dataParsers,xhrObject);}catch(parseDataError){return Ajax.done(xhrObject,2,status,statusText,parseDataError.message,done);}eventName='success';}xhrObject.errorCode=error;xhrObject.status=status;xhrObject.statusText=statusText;if(done){done();}try{if(xhrObject[eventName]){xhrObject[eventName].call(xhrObject.owner,eventArgs,xhrObject);}if(xhrObject.complete)xhrObject.complete.call(xhrObject.owner,error,xhrObject);}finally{xhrObject.xhr=null;xhrObject.owner.progress();}},error:function(xhrObject,errorThrown){xhrObject.xhr={readyState:4};xhrObject.errorThrown=errorThrown;xhrObject.owner.callback(errorThrown.message,-1);}});Ajax.dataParsers.text=function(xhrObject){var responseText;try{responseText=xhrObject.xhr.responseText;}catch(ieResponseTextError){responseText='';}return xhrObject.responseText=responseText;};Ajax.transports.text=function(xhrObject,parseData,done){var headers={},xhr,key,callback;xhrObject.type=xhrObject.type?xhrObject.type.toUpperCase():'GET';xhrObject.async=xhrObject.async!==false;if(xhrObject.data&&xhrObject.type==='GET'){xhrObject.url=Ajax.concatUrl(xhrObject.url,xhrObject.data);xhrObject.data=null;}if(xhrObject.cache!==true){xhrObject.url=Ajax.addCachePostfix(xhrObject.url);}headers.Accept=xhrObject.dataType in Ajax.accepts?Ajax.accepts[xhrObject.dataType]+", "+defaultAccepts+"; q=0.01":defaultAccepts;if(xhrObject.data){headers['Content-Type']="application/x-www-form-urlencoded; charset="+(xhrObject.charset||"UTF-8");}if(xhrObject.charset){headers["Accept-Charset"]=value;}if(!xhrObject.crossDomain){headers['X-Requested-With']='XMLHttpRequest';}for(key in xhrObject.headers){headers[key]=xhrObject.headers[key];}xhrObject.xhr=xhr=Ajax.createNativeRequest();xhrObject.owner.callback=callback=function(eventArgs,error){var xhr=xhrObject.xhr,status,statusText;try{if(!xhr||(!error&&xhr.readyState!==4)){return;}xhr.onreadystatechange=xhrObject.owner.callback=Function.empty;if(error){if(xhr.readyState!==4){xhr.abort();}status=error;statusText="";}else{status=xhr.status;try{statusText=xhr.statusText;}catch(firefoxCrossDomainError){statusText="";}if(Ajax.checkStatus(status)){eventArgs=parseData||Ajax.dataParsers[xhrObject.dataType]||Ajax.dataParsers.text;}else{error=1;eventArgs=statusText;}}xhr=null;}catch(firefoxAccessError){return Ajax.error(xhrObject,firefoxAccessError);}Ajax.done(xhrObject,error,status,statusText,eventArgs,done);};if(xhrObject.start&&xhrObject.start.call(xhrObject.owner,xhrObject.data,xhrObject)===false)return callback('Prevented',-3);try{if(xhrObject.username)xhr.open(xhrObject.type,xhrObject.url,xhrObject.async,xhrObject.username,xhrObject.password);else xhr.open(xhrObject.type,xhrObject.url,xhrObject.async);}catch(ieOpenError){return Ajax.error(xhrObject,ieOpenError);}for(key in headers)try{xhr.setRequestHeader(key,headers[key]);}catch(firefoxSetHeaderError){}try{xhr.send(xhrObject.data);}catch(sendError){return Ajax.error(xhrObject,sendError);}if(!xhrObject.async){callback();}else if(xhr.readyState===4){setTimeout(callback,0);}else{xhr.onreadystatechange=callback;if(xhrObject.timeouts>0){setTimeout(function(){callback('Timeout',-2);},xhrObject.timeouts);}}};Object.map("get post",function(type){Ajax[type]=function(url,data,onsuccess,onerror,dataType){if(typeof data=='function'){dataType=onerror;onerror=onsuccess;onsuccess=data;data=null;}return Ajax.send({url:url,data:data,success:onsuccess,error:onerror,type:type,dataType:dataType});};});return Ajax;})();Ajax.accepts.script="text/javascript, application/javascript, application/ecmascript, application/x-ecmascript";Ajax.dataParsers.script=function(xhrObject){window.execScript(this.text(xhrObject));};Ajax.transports.script=function(xhrObject,parseData,done){if(!xhrObject.crossDomain){return Ajax.transports.text(xhrObject,parseData&&function(xhrObject){this.script(xhrObject);return parseData(xhrObject);},done);}var script,t,callback;xhrObject.type="GET";if(xhrObject.cache!==false){xhrObject.cache=false;xhrObject.url=Ajax.addCachePostfix(xhrObject.url);}if(xhrObject.data){xhrObject.url=Ajax.concatUrl(xhrObject.url,xhrObject.data);xhrObject.data=null;}xhrObject.xhr=script=document.createElement('SCRIPT');xhrObject.owner.callback=callback=function(eventArgs,error){var script=xhrObject.xhr;if(script&&(error||!script.readyState||!/in/.test(script.readyState))){xhrObject.owner.callback=Function.empty;script.onerror=script.onload=script.onreadystatechange=null;script.parentNode.removeChild(script);script=null;if(error){Ajax.done(xhrObject,error,error,"",eventArgs,done);}else{Ajax.done(xhrObject,0,200,"OK",parseData||Function.empty,done);}}};script.src=xhrObject.url;script.type="text/javascript";script.async="async";if(xhrObject.charset)script.charset=xhrObject.charset;if(xhrObject.start&&xhrObject.start.call(xhrObject.owner,xhrObject.data,xhrObject)===false)return callback('Prevented',-3);script.onload=script.onreadystatechange=callback;script.onerror=function(e){callback('Script Execute Error',2);};if(xhrObject.timeouts>0){setTimeout(function(){callback('Timeout',-2);},xhrObject.timeouts);}t=document.getElementsByTagName("SCRIPT")[0];t.parentNode.insertBefore(script,t);};Ajax.transports.jsonp=function(xhrObject,parseData){if(xhrObject.jsonp===undefined){xhrObject.jsonp='callback';}var jsonpCallback=xhrObject.jsonpCallback||(xhrObject.jsonpCallback='jsonp'+Date.now()+JPlus.id++),jsonpCallbackOverwritten=window[jsonpCallback],responseData;if(xhrObject.jsonp){if(xhrObject.url.indexOf(xhrObject.jsonp+'=?')>=0){xhrObject.url=xhrObject.url.replace(xhrObject.jsonp+'=?',xhrObject.jsonp+'='+jsonpCallback);}else{xhrObject.url=Ajax.concatUrl(xhrObject.url,xhrObject.jsonp+"="+jsonpCallback);}}window[jsonpCallback]=function(){responseData=arguments;};Ajax.transports.script(xhrObject,function(xhrObject){if(!responseData){throw new Error(jsonpCallback+' was not called');}return responseData[0];},function(){window[jsonpCallback]=jsonpCallbackOverwritten;});};Ajax.jsonp=function(url,data,onsuccess,onerror){if(typeof data==='function'){onerror=onsuccess;onsuccess=data;data=null;}return Ajax.send({url:url,dataType:'jsonp',data:data,success:onsuccess,error:onerror});};var Control=Dom.extend({xtype:"control",create:function(){assert.isString(this.tpl,"Control#create: 无法获取或创建当前控件所关联的 DOM 节点。请为控件定义 tpl 属性或重写 create 函数。");return Dom.parseNode(this.tpl.replace(/x-control/g,'x-'+this.xtype));},init:Function.empty,constructor:function(options){var me=this,opt={},node;if(options){if(options.constructor===Object){Object.extend(opt,options);if(opt.node){node=opt.node;delete opt.node;}else if(opt.selector){node=Dom.find(opt.selector);delete opt.selector;}else if(opt.dom){node=opt.dom;delete opt.dom;}if(node){node=Dom.getNode(node);}}else{node=Dom.getNode(options);}}me.node=node||me.create(opt);assert.isNode(me.node,"Dom#constructor(options): Dom 对象的 {node} 不是节点。",me.node);me.init(opt);me.set(opt);}});var ListControl=Control.extend({tpl:'<ul class="x-control"/>',insertBefore:function(childControl,refControl){if(childControl.node.tagName!=='LI'){var li=Dom.create('LI');li.append(childControl);childControl=li;}childControl.attach(this.node,refControl&&refControl.node||null);return childControl;},removeChild:function(childControl){if(childControl.node.parentNode!==this.node){var li=childControl.parent();if(!li){return null;}childControl.detach(li.node);childControl=li;}childControl.detach(this.node);return childControl;},add:function(){var args=arguments;if(args.length===1){return this.append(args[0]);}Object.each(args,this.append,this);return this;},addAt:function(index,item){return this.insertBefore(Dom.parse(item),this.child(index));},removeAt:function(index){var child=this.child(index);return child?this.removeChild(child):null;},set:function(items){if(Array.isArray(items)){this.empty();this.add.apply(this,items);return this;}return Dom.prototype.set.apply(this,arguments);},item:Dom.prototype.child,indexOf:function(item){return item&&item.parent&&this.equals(item.parent())?item.index():-1;},itemOn:function(eventName,fn,scope){return this.on(eventName,function(e){for(var c=this.node.firstChild,target=e.target;c;c=c.nextSibling){if(c===target||Dom.has(c,target)){return fn.call(scope||this,new Dom(c),e);}}});}});ListControl.aliasMethods=function(controlClass,targetProperty,removeChildProperty){controlClass.defineMethods(targetProperty,'add addAt removeAt item');removeChildProperty=removeChildProperty||targetProperty;controlClass.prototype.set=function(items){if(Array.isArray(items)){var child=this[removeChildProperty];if(child)child.empty();this.add.apply(this,items);return this;}return this.base('set');};controlClass.prototype.removeChild=function(childControl){var child=this[removeChildProperty];if(child)childControl.remove(childControl);childControl.detach(this.node);return childControl;};};var ContentControl=Control.extend({tpl:'<div class="x-control">			<div class="x-control-content"></div>		</div>',content:function(){return this.find('x-'+this.xtype+'-content')||new Dom(this.node);},state:function(name,value){this.toggleClass('x-'+this.xtype+'-'+name,value);}}).defineMethods("content()","setHtml getHtml setText getText");var TreeControl=ListControl.extend({createTreeItem:function(childControl,li){return new TreeControl.Item(childControl);},initTreeItem:function(li,childControl){var subControl=li.addClass('x-'+this.xtype+'-item').find('>ul');if(!childControl){childControl=(subControl?(subControl.prev()||subControl.prev(null)):(li.first()||li.first(null)))||Dom.parse('');}childControl=this.createTreeItem(childControl,li);li.prepend(childControl);if(subControl){childControl.setSubControl(subControl);}li.dataField().item=childControl;childControl.parentControl=this;return childControl;},init:function(){for(var c=this.first();c;c=c.next()){this.initTreeItem(c);}},insertBefore:function(childControl,refControl){var item;if(childControl.node.tagName!=='LI'){item=childControl;childControl=Dom.create('LI');}childControl.attach(this.node,refControl&&refControl.node||null);return this.initTreeItem(childControl,item);},removeChild:function(childControl){if(childControl=ListControl.prototype.removeChild.call(this,childControl)){var data=childControl.dataField();delete data.item.parentControl;delete data.item;}return childControl;},item:function(index){if(index=this.child(index)){index=index.dataField().item;}return index;}});TreeControl.Item=ContentControl.extend({tpl:'<a class="x-control"></a>',subControl:null,createSubControl:function(control){return new TreeControl(control);},initSubControl:Function.empty,uninitSubControl:Function.empty,getSubControl:function(){if(!this.subControl){this.setSubControl(this.createSubControl());}return this.subControl;},setSubControl:function(treeControl){if(treeControl){if(!(treeControl instanceof TreeControl)){treeControl=this.createSubControl(treeControl);}if(!treeControl.closest('body')&&this.node.parentNode){this.node.parentNode.appendChild(treeControl.node);}this.subControl=treeControl;this.initSubControl(treeControl);treeControl.owner=this;}else if(this.subControl){this.subControl.remove();this.uninitSubControl(this.subControl);delete this.subControl.owner;this.subControl=null;}return this;},attach:function(parentNode,refNode){parentNode.insertBefore(this.node,refNode);var subControl=this.subControl;if(subControl&&!subControl.closest('body')){parentNode.insertBefore(subControl.node,refNode);}},detach:function(parentNode){if(this.node.parentNode===parentNode){parentNode.removeChild(this.node);}var subControl=this.subControl;if(subControl){parentNode.removeChild(subControl.node);}}});ListControl.aliasMethods(TreeControl.Item,'getSubControl()','subControl');Dom.implement({pin:(function(){var aligners={xc:function(opt){opt.x=opt.tp.x+(opt.ts.x-opt.s.x)/2+opt.ox;},ll:function(opt,r){opt.x=opt.tp.x-opt.s.x-opt.ox;if(r>0&&opt.x<=opt.dp.x){aligners.rr(opt,--r);}},rr:function(opt,r){opt.x=opt.tp.x+opt.ts.x+opt.ox;if(r>0&&opt.x+opt.s.x>=opt.dp.x+opt.ds.x){aligners.ll(opt,--r);}},lr:function(opt,r){opt.x=opt.tp.x+opt.ox;if(r>0&&opt.x+opt.s.x>=opt.dp.x+opt.ds.x){aligners.rl(opt,--r);}},rl:function(opt,r){opt.x=opt.tp.x+opt.ts.x-opt.s.x-opt.ox;if(r>0&&opt.x<=opt.dp.x){aligners.lr(opt,--r);}},yc:function(opt){opt.y=opt.tp.y+(opt.ts.y-opt.s.y)/2+opt.oy;},tt:function(opt,r){opt.y=opt.tp.y-opt.s.y-opt.oy;if(r>0&&opt.y<=opt.dp.y){aligners.bb(opt,--r);}},bb:function(opt,r){opt.y=opt.tp.y+opt.ts.y+opt.oy;if(r>0&&opt.y+opt.s.y>=opt.dp.y+opt.ds.y){aligners.tt(opt,--r);}},tb:function(opt,r){opt.y=opt.tp.y+opt.oy;if(r>0&&opt.y+opt.s.y>=opt.dp.y+opt.ds.y){aligners.bt(opt,--r);}},bt:function(opt,r){opt.y=opt.tp.y+opt.ts.y-opt.s.y-opt.oy;if(r>0&&opt.y<=opt.dp.y){aligners.tb(opt,--r);}}};return function(dom,position,offsetX,offsetY,enableReset){assert(position,"Dom#pin(ctrl, position,  offsetX, offsetY): {position} 格式不正确。正确的格式如 lt",position);dom=dom instanceof Dom?dom:Dom.get(dom);var opt={s:this.getSize(),ts:dom.getSize(),tp:dom.getPosition(),ds:document.getSize(),dp:document.getPosition(),ox:offsetX||0,oy:offsetY||0},r=enableReset===false?0:2,x,y;if(position.length<=1){if(position==='r'){x='rr';y='tb';}else{x='lr';y='bb';}}else{x=position.substr(0,2);y=position.substr(3);}assert(aligners[x]&&aligners[y],"Dom#pin(ctrl, position,  offsetX, offsetY): {position} 格式不正确。正确的格式如 lt",position);aligners[x](opt,r);aligners[y](opt,r);return this.setPosition(opt);};})()});var Menu=TreeControl.extend({xtype:'menu',showDuration:null,floating:false,createTreeItem:function(childControl){if(!(childControl instanceof MenuItem)){if(childControl.node.nodeType===3){if(/^\s*-\s*$/.test(childControl.getText())){childControl.remove();childControl=new MenuSeperator;}else{var t=childControl;childControl=new MenuItem;childControl.append(t);}}else if(childControl.hasClass('x-menuseperator')){childControl=new MenuSeperator(childControl);}else{childControl=new MenuItem(childControl);}}return childControl;},init:function(){this.dataField().control=this;TreeControl.prototype.init.call(this);},show:function(){Dom.prototype.show.call(this,arguments,{duration:this.showDuration});if(this.floating)document.once('mouseup',this.hide,this);this.trigger('show');return this;},hide:function(){Dom.prototype.hide.call(this,arguments,{duration:this.showDuration});this.hideSubMenu();this.trigger('hide');return this;},showAt:function(x,y){if(!this.closest('body')){this.appendTo();}this.show();this.setPosition(x,y);return this;},showBy:function(ctrl,pos,offsetX,offsetY,enableReset){if(!this.closest('body')){this.appendTo(ctrl.parent());}this.show();this.pin(ctrl,pos||'r',offsetX!=null?offsetX:-5,offsetY!=null?offsetY:-5,enableReset);return this;},showSubMenu:function(menuItem){if(!this.floating)document.once('mouseup',this.hideSubMenu,this);this.hideSubMenu();menuItem.state("hover",true);if(menuItem.subControl){this.currentSubMenu=menuItem;menuItem.subControl.showBy(menuItem);}},hideSubMenu:function(){if(this.currentSubMenu){this.currentSubMenu.subControl.hide();this.currentSubMenu.state("hover",false);this.currentSubMenu=null;}}});var MenuItem=TreeControl.Item.extend({xtype:'menuitem',createSubControl:function(treeControl){return new Menu(treeControl);},initSubControl:function(treeControl){treeControl.hide();treeControl.floating=false;this.prepend('<i class="x-menuitem-arrow"></i>');this.on('mouseup',this._cancelHideMenu);},uninitSubControl:function(treeControl){treeControl.floating=true;this.remove('x-menuitem-arrow');this.un('mouseup',this._cancelHideMenu);},onMouseOver:function(){this.state("hover",true);if(this.subControl)this.showSubMenu();else if(this.parentControl)this.parentControl.hideSubMenu();},onMouseOut:function(){if(!this.subControl)this.state("hover",false);},init:function(){if(this.hasClass('x-'+this.xtype)){this.unselectable();this.on('mouseover',this.onMouseOver);this.on('mouseout',this.onMouseOut);}},_cancelHideMenu:function(e){e.stopPropagation();},_hideTargetMenu:function(e){var tg=e.relatedTarget;while(tg&&!Dom.hasClass(tg,'x-menu')){tg=tg.parentNode;}if(tg){new Dom(tg).dataField().control.hideSubMenu();}},getSubMenu:TreeControl.Item.prototype.getSubControl,setSubMenu:TreeControl.Item.prototype.setSubControl,showSubMenu:function(){this.parentControl&&this.parentControl.showSubMenu(this);return this;},hideSubMenu:function(){this.parentControl&&this.parentControl.hideSubMenu(this);return this;}});var MenuSeperator=MenuItem.extend({tpl:'<div class="x-menuseperator"></div>',init:Function.empty});var Fx=(function(){var cache={};function interval(){var i=this.length;while(--i>=0)this[i].step();}return Deferrable.extend({options:{duration:300,fps:50,transition:function(p){return-(Math.cos(Math.PI*p)-1)/2;}},init:Function.empty,set:Function.empty,step:function(){var me=this,time=Date.now()-me.time,options=me.options;if(time<options.duration){me.set(options.transition(time/options.duration));}else{me.end(false);}},run:function(options,link){var me=this,defaultOptions,duration;if(!me.defer(options,link)){defaultOptions=me.options;me.options=options=Object.extend({transition:defaultOptions.transition,fps:defaultOptions.fps},options);duration=options.duration;assert(duration==undefined||duration===0||+duration,"Fx#run(options, link): {duration} 必须是数字。如果需要使用默认的时间，使用 -1 。",duration);options.duration=duration!==-1&&duration!=undefined?duration<0?-defaultOptions.duration/duration:duration:defaultOptions.duration;if(options.start&&options.start.call(options.target,options,me)===false){me.progress();}else{me.init(options);me.set(0);me.time=0;me.resume();}}return me;},end:function(isAbort){var me=this;me.pause();me.set(1);try{if(me.options.complete){me.options.complete.call(me.options.target,isAbort,me);}}finally{delete me.options;me.progress();}return me;},stop:function(){this.abort();this.end(true);return this;},pause:function(){var me=this,fps,intervals;if(me.timer){me.time=Date.now()-me.time;fps=me.options.fps;intervals=cache[fps];intervals.remove(me);if(intervals.length===0){clearInterval(me.timer);delete cache[fps];}me.timer=0;}},resume:function(){var me=this,fps,intervals;if(!me.timer){me.time=Date.now()-me.time;fps=me.options.fps;intervals=cache[fps];if(intervals){intervals.push(me);me.timer=intervals[0].timer;}else{me.timer=setInterval(interval.bind(cache[fps]=[me]),Math.round(1000/fps));}}return me;}});})();Object.extend(Fx,{tweeners:{},defaultTweeners:[],numberTweener:{get:function(target,name){return Dom.styleNumber(target.node,name);},compute:function(from,to,delta){return(to-from)*delta+from;},parse:function(value){return typeof value=="number"?value:parseFloat(value);},set:function(target,name,value){target.node.style[name]=value;}},Tween:Fx.extend({constructor:function(){},set:function(delta){var options=this.options,params=options.params,target=options.target,tweener,key,value;for(key in params){value=params[key];tweener=value.tweener;tweener.set(target,key,tweener.compute(value.from,value.to,delta));}},init:function(options){var key,tweener,part,value,parsed,i,params={};for(key in options.params){value=options.params[key];if(typeof value==='string'&&(part=/^([+-]=|(.+?)-)(.*)$/.exec(value))){value=part[3];}tweener=Fx.tweeners[key=key.toCamelCase()];if(!tweener){if(key in Dom.styleNumbers){tweener=Fx.numberTweener;}else{i=Fx.defaultTweeners.length;while(i-->0){parsed=Fx.defaultTweeners[i].parse(value,key);if(parsed||parsed===0){tweener=Fx.defaultTweeners[i];break;}}if(!tweener){continue;}}Fx.tweeners[key]=tweener;}if(part){parsed=part[2];i=parsed?tweener.parse(parsed):tweener.get(options.target,key);parsed=parsed?tweener.parse(value):(i+parseFloat(part[1]==='+='?value:'-'+value));}else{parsed=tweener.parse(value);i=tweener.get(options.target,key);}params[key]={tweener:tweener,from:i,to:parsed};assert(i!==null&&parsed!==null,"Fx.Tween#init(options): 无法正确获取属性 {key} 的值({from} {to})。",key,i,parsed);}options.params=params;}}),createTweener:function(tweener){return Object.extendIf(tweener,Fx.numberTweener);}});Object.each(Dom.styleFix,function(value,key){Fx.tweeners[key]=this;},Fx.createTweener({set:function(target,name,value){Dom.styleFix[name].call(target,value);}}));Fx.tweeners.scrollTop=Fx.createTweener({set:function(target,name,value){target.setScroll(null,value);},get:function(target){return target.getScroll().y;}});Fx.tweeners.scrollLeft=Fx.createTweener({set:function(target,name,value){target.setScroll(value);},get:function(target){return target.getScroll().x;}});Fx.defaultTweeners.push(Fx.createTweener({set:navigator.isStd?function(target,name,value){target.node.style[name]=value+'px';}:function(target,name,value){try{target.node.style[name]=value;}catch(e){}}}));(function(){var opacity0={opacity:0},displayEffects=Fx.displayEffects={opacity:function(){return opacity0;}},toggle=Dom.prototype.toggle,shift=Array.prototype.shift,height='height marginTop paddingTop marginBottom paddingBottom';function fixProp(options,elem,prop){options.orignal[prop]=elem.style[prop];elem.style[prop]=Dom.styleNumber(elem,prop)+'px';}Object.each({all:height+' opacity width',height:height,width:'width marginLeft paddingLeft marginRight paddingRight'},function(value,key){value=Object.map(value,this,{});displayEffects[key]=function(options,elem,isShow){options.orignal.overflow=elem.style.overflow;elem.style.overflow='hidden';if(Dom.styleString(elem,'display')==='inline'){options.orignal.display=elem.style.display;elem.style.display='inline-block';}if(key==='height'){fixProp(options,elem,'width');}else if(key==='width'){fixProp(options,elem,'height');}return value;};},function(){return 0;});Object.map('left right top bottom',function(key,index){key='margin'+key.capitalize();return function(options,elem,isShow){elem.parentNode.style.overflow='hidden';var params={},fromValue,toValue,key2,delta;if(index<=1){key2=index===0?'marginRight':'marginLeft';fromValue=-elem.offsetWidth-Dom.styleNumber(elem,key2);toValue=Dom.styleNumber(elem,key);params[key]=isShow?(fromValue+'-'+toValue):(toValue+'-'+fromValue);fixProp(options,elem,'width');delta=toValue-fromValue;toValue=Dom.styleNumber(elem,key2);fromValue=toValue+delta;params[key2]=isShow?(fromValue+'-'+toValue):(toValue+'-'+fromValue);}else{key2=index===2?'marginBottom':'marginTop';fromValue=-elem.offsetHeight-Dom.styleNumber(elem,key2);toValue=Dom.styleNumber(elem,key);params[key]=isShow?(fromValue+'-'+toValue):(toValue+'-'+fromValue);}return params;};},displayEffects);function initArgs(args){var defaultConfigs=args[1];if(defaultConfigs&&typeof defaultConfigs==='object'){args=args[0];}else{defaultConfigs=null;}args=!args[0]||typeof args[0]!=='object'?{duration:args[0],callback:args[1],link:args[2]}:args[0];Object.extendIf(args,defaultConfigs);if(!args.effect){args.effect='opacity';}else if(args.duration===undefined){args.duration=-1;}args.callback=args.callback||Function.empty;assert(Fx.displayEffects[args.effect],"Dom#toggle(effect, duration, callback, link): 不支持 {effect} 。",args.effect);return args;}Dom.implement({fx:function(){var data=this.dataField();return data.$fx||(data.$fx=new Fx.Tween());}},2).implement({animate:function(params,duration,callback,link){assert.notNull(params,"Dom#animate(params, duration, oncomplete, link): {params} ~",params);if(params.params){link=params.link;}else{params={params:params,duration:duration,complete:callback};}params.target=this;assert(!params.duration||typeof params.duration==='number',"Dom#animate(params, duration, callback, link): {duration} 必须是数字。如果需要制定为默认时间，使用 -1 。",params.duration);assert(!params.complete||typeof params.complete==='function',"Dom#animate(params, duration, callback, link): {callback} 必须是函数",params.complete);this.fx().run(params,link);return this;},show:function(){var me=this,args=arguments;if(args.length===0){Dom.show(me.node);}else{args=initArgs(args);if(args.duration==null){Dom.show(me.node);args.callback.call(me,false,false);}else{me.fx().run({target:me,duration:args.duration,start:function(options,fx){var elem=this.node,t,params,param;if(!Dom.isHidden(elem)){args.callback.call(me,true,true);return false;}Dom.show(elem);options.orignal={};options.params=params={};t=Fx.displayEffects[args.effect](options,elem,true);for(param in t){options.orignal[param]=elem.style[param];}for(param in t){if(t[param]===0){params[param]=Dom.styleNumber(elem,param);elem.style[param]=0;}else{params[param]=t[param];}}},complete:function(isAbort,fx){Object.extend(this.node.style,fx.options.orignal);args.callback.call(me,false,isAbort);}},args.link);}}return me;},hide:function(){var me=this,args=arguments;if(args.length===0){Dom.hide(me.node);}else{args=initArgs(args);if(args.duration===null){Dom.hide(me.node);args.callback.call(me,false,false);}else{me.fx().run({target:me,duration:args.duration,start:function(options,fx){var elem=this.node,params,param;if(Dom.isHidden(elem)){args.callback.call(me,false,true);return false;}options.orignal={};options.params=params=Fx.displayEffects[args.effect](options,elem,false);for(param in params){options.orignal[param]=elem.style[param];}},complete:function(isAbort,fx){var elem=this.node;Dom.hide(elem);Object.extend(elem.style,fx.options.orignal);args.callback.call(me,false,isAbort);}},args.link);}}return this;},toggle:function(){var me=this;me.fx().then(function(args){toggle.apply(me,args);return false;},arguments);return me;}});})();var ICollapsable={collapseDuration:-1,onCollapsing:function(){return this.trigger('collapsing');},onCollapse:function(){return this.trigger('collapse');},onExpanding:function(){return this.trigger('expanding');},onExpand:function(){return this.trigger('expand');},isCollapsed:function(){var body=this.body?this.body():this;return!body||Dom.isHidden(body.node);},toggleCollapse:function(duration){return this[this.isCollapsed()?'expand':'collapse'](duration);},collapse:function(){var me=this,body,callback;if(me.onCollapsing()!==false&&(body=me.body?me.body():me)){body.hide(arguments,{effect:'height',duration:me.collapseDuration,callback:function(){me.addClass('x-'+me.xtype+'-collapsed');me.onCollapse();},link:'ignore'});}return me;},expand:function(){var me=this,body;if(me.onExpanding()!==false&&(body=me.body?me.body():me)){me.removeClass('x-'+me.xtype+'-collapsed');body.show(arguments,{effect:'height',duration:me.collapseDuration,callback:function(){me.onExpand();},link:'ignore'});}return me;}};var TreeView=TreeControl.extend({xtype:'treeview',depth:0,createTreeItem:function(childControl){if(!(childControl instanceof TreeNode)){var t=childControl;childControl=new TreeNode();childControl.content().append(t);}childControl.setDepth(this.depth+1);if(this.owner){this.owner.update();childControl.parentNode=this.owner;}return childControl;},isLastNode:function(){return false;},init:function(){TreeControl.prototype.init.call(this);this.on('click',this.onClick);},invoke:function(funcName,args){var subTree=this,c,target;args=args||[];for(var c=subTree.first();c;c=c.next()){target=c.dataField().item;target[funcName].apply(target,args);}return this;},collapse:function(duration){return this.invoke('collapse',[duration]);},collapseAll:function(duration){return this.invoke('collapseAll',[duration]);},expand:function(duration){return this.invoke('expand',[duration]);},expandAll:function(duration){return this.invoke('expandAll',[duration]);},collapseTo:function(depth,duration){return this.invoke('collapseTo',[--depth,duration]);},onClick:function(e){var target=e.target;if(/\bx-treenode-(minus|plus|loading)\b/.test(target.className))return;if((target=new Dom(target).closest('.x-treenode'))&&(target=target.dataField().control)){this.selectNode(target);return false;}},selectNode:function(node){if(this.trigger('selecting',node)){var old=this.getSelectedNode();this.setSelectedNode(node);if(old!==node)this.trigger('change');}return this;},setSelectedNode:function(node){if(this.selectedNode)this.selectedNode.state('selected',false);this.selectedNode=node;if(node!=null){node.state('selected',true);}return this;},getSelectedNode:function(){return this.selectedNode;}});var TreeNode=TreeControl.Item.extend(ICollapsable).implement({xtype:'treenode',tpl:'<a class="x-control"><span></span></a>',depth:0,body:function(){return this.subControl;},content:function(){return this.last('span');},createSubControl:function(control){return new TreeView(control).removeClass('x-treeview').addClass('x-treeview-subtree');},initSubControl:function(treeControl){treeControl.depth=this.depth;treeControl.un('click',treeControl.onClick);},_setSpan:function(depth,className){this.each(function(node){var first=node.first(depth).node;if(first.tagName=='SPAN')first.className=className;node._setSpan(depth,className);});},_markAsLastNode:function(){this.addClass('x-treenode-last');this._setSpan(this.depth-1,'x-treenode-space x-treenode-none');},_clearMarkAsLastNode:function(){this.removeClass('x-treenode-last');this._setSpan(this.depth-1,'x-treenode-space');},span:function(index){return this.content().prev(index);},update:function(){this.updateNodeType();var last=this.subControl.item(-1),lastNode;if(last){lastNode=this._lastNode;if(!lastNode||lastNode.node!==last.node){last._markAsLastNode();this._lastNode=last;if(lastNode)lastNode._clearMarkAsLastNode();}}},updateNodeType:function(){this.setNodeType(this.subControl&&this.subControl.first()?this.isCollapsed()?'plus':'minus':'normal');},isLastNode:function(){return this.parentNode&&this.parentNode._lastNode===this;},onDblClick:function(e){this.toggleCollapse();e.preventDefault();e.stopPropagation();},init:function(options){this.unselectable();this.on('dblclick',this.onDblClick,this);this.dataField().control=this;},getNodeType:function(){var span=this.span(0);return span?(/x-treenode-(.+)/.exec(span.node.className.replace(/\bx-treenode-space\b/,''))||[0,"line"])[1]:null;},setNodeType:function(type){var span=this.span(0);if(span){span.node.className='x-treenode-space x-treenode-'+type;}return this;},onCollapse:function(){ICollapsable.onCollapse.call(this);this.updateNodeType();},onExpanding:function(){this.setNodeType(this.subControl&&this.subControl.first()?'minus':'normal');ICollapsable.onExpanding.call(this);},onExpand:function(){if(this.subControl){this.subControl.node.style.height='auto';}ICollapsable.onExpand.call(this);},expandAll:function(duration,maxDepth){if(this.subControl&&!(maxDepth===0)){this.expand(duration);this.invoke('expandAll',[duration,--maxDepth]);}return this;},collapseAll:function(duration,maxDepth){if(this.subControl&&!(maxDepth===0)){this.invoke('collapseAll',[duration,--maxDepth]);this.collapse(duration);}return this;},collapseTo:function(depth,duration){duration=duration===undefined?0:duration;depth=depth===undefined?1:depth;if(depth>0){this.expand(duration);}else{this.collapse(duration);}this.invoke('collapseTo',[--depth,duration]);},invoke:function(funcName,args){if(this.subControl){this.subControl.invoke(funcName,args);}return this;},getDepth:function(){return this.depth;},setDepth:function(value){assert(value>=0,"TreeNode#setDepth(value): {value} 必须是不小于 0 的整数",value);var me=this,currentDepth=me.depth,span,current=me;while(currentDepth>value){me.removeChild(elem.first());currentDepth--;}while(currentDepth<value){me.prepend(Dom.createNode('span','x-treenode-space'));currentDepth++;}me.depth=value;span=this.span(0);if(currentDepth){span.un('click',this.onDblClick).on('click',this.onDblClick,this);}while((current=current.parentNode)&&(span=span.prev())){span.node.className=current.isLastNode()?'x-treenode-space x-treenode-none':'x-treenode-space';}me.updateNodeType();me.invoke('setDepth',[++value]);},getTreeView:function(){var n=this;while(n)n=n.parentNode;return n?n.parentControl:null;},ensureVisible:function(duration){var n=this;while(n=n.parentNode){n.expand(duration);}return this;}});var IInput={inputProxy:null,input:function(){return this.inputProxy||(this.inputProxy=/^(INPUT|SELECT|TEXTAREA|BUTTON)$/.test(this.node.tagName)?new Dom(this.node):this.find("input,select,textarea")||Dom.parse('<input type="hidden">').setAttr('name',Dom.getAttr(this.node,'name')).appendTo(this));},state:function(name,value){this.toggleClass('x-'+this.xtype+'-'+name,value);},form:function(){return new Dom(this.input().node.form);},setAttr:function(name,value){var dom=this;if(/^(disabled|readonly|checked|selected|actived)$/i.test(name)){value=value!==false;this.state(name.toLowerCase(),value);dom=this.input();}else if(/^(value|name|form)$/i.test(name)){dom=this.input();}Dom.prototype.setAttr.call(dom,name,value);return this;},getAttr:function(name,type){return Dom.getAttr((/^(disabled|readonly|checked|selected|actived|value|name|form)$/i.test(name)?this.input():this).node,name,type);},getText:function(){return Dom.getText(this.input().node);},setText:function(){Dom.prototype.setText.apply(this.input(),arguments);return this;},select:function(){Dom.prototype.select.apply(this.input(),arguments);return this;}};var Button=ContentControl.extend({xtype:'button',type:'button',tpl:'<button class="x-control" type="button"></button>',create:function(options){this.tpl=this.tpl.replace('type="button"','type="'+(options.type||this.type)+'"');return Control.prototype.create.call(this,options);}}).implement(IInput);var IDropDownOwner={dropDown:null,dropDownWidth:-1,onDropDownShow:function(){this.trigger('dropdownshow');},onDropDownHide:function(){this.trigger('dropdownhide');},attach:function(parentNode,refNode){var dropDown=this.dropDown;if(dropDown&&!dropDown.closest('body')){dropDown.attach(parentNode,refNode);}Dom.prototype.attach.call(this,parentNode,refNode);},detach:function(parentNode){Dom.prototype.detach.call(this,parentNode);if(this.dropDown){this.dropDown.detach(parentNode);}},setDropDown:function(dom){if(dom){dom=dom instanceof Dom?dom:Dom.get(dom);this.dropDown=dom.addClass('x-dropdown').hide();if(!dom.closest('body')){this.after(dom);if(navigator.isQuirks&&(dom=dom.parent())&&dom.getStyle('zIndex')===0){dom.setStyle('zIndex',1);}}}else if(dom=this.dropDown){dom.remove();this.dropDown=null;}return this;},getDropDown:function(){return this.dropDown;},isDropDownHidden:function(){return this.dropDown&&Dom.isHidden(this.dropDown.node);},toggleDropDown:function(e){return this.isDropDownHidden()?this.showDropDown(e):this.hideDropDown();},showDropDown:function(e){var me=this;if(!e||!me.getAttr('disabled')&&!me.getAttr('readonly')){if(me.isDropDownHidden()){var dropDown=me.dropDown.show().pin(me,'b',0,-1),dropDownWidth=me.dropDownWidth;if(dropDownWidth<0){dropDownWidth=Math.max(me.getSize().x,Dom.styleNumber(dropDown.node,'min-width'),dropDown.getScrollSize().x);}if(dropDownWidth!=='auto'){dropDown.setSize(dropDownWidth);}document.on('mouseup',me.hideDropDown,me);}me.onDropDownShow();}return this;},hideDropDown:function(e){var dropDown=this.dropDown;if(dropDown&&!this.isDropDownHidden()){if(e){e=e.target;if(dropDown.node==e||this.node===e||Dom.has(dropDown.node,e)||Dom.has(this.node,e))return this;}dropDown.hide();document.un('mouseup',this.hideDropDown);}this.onDropDownHide();return this;}};var MenuButton=Button.extend(IDropDownOwner).implement({xtype:'menubutton',tpl:'<button class="x-button x-control" type="button"><span class="x-menubutton-arrow"></span></button>',createDropDown:function(existDom){if(existDom&&!existDom.hasClass('x-menu')){return existDom;}assert(window.Menu,"必须载入 Controls.Menu.Menu 组件才能初始化 x-menu 的菜单项。");return new Menu(existDom).on('click',this.onDropDownClick,this);},state:function(name,value){return this.toggleClass('x-button-'+name,value);},init:function(){this.setDropDown(this.createDropDown(this.next('.x-dropdown')));this.on('click',this.toggleDropDown,this);},onDropDownShow:function(){this.state('actived',true);IDropDownOwner.onDropDownShow.apply(this,arguments);},onDropDownHide:function(){this.state('actived',false);IDropDownOwner.onDropDownHide.apply(this,arguments);},onDropDownClick:function(){this.hideDropDown();}});ListControl.aliasMethods(MenuButton,'dropDown');var SplitButton=MenuButton.extend({xtype:'splitbutton',tpl:'<span class="x-splitbutton x-buttongroup">				<button class="x-button"></button>				<button class="x-button"><span class="x-menubutton-arrow x-menubutton-arrow-down"></span></button>			</span>',content:function(){return this.find('.x-button');},input:function(){return this.content();},state:function(name,value){if(name=="disabled"){this.query('.x-button').setAttr(name,value).toggleClass('x-button-disabled',value);}else if(name=="actived"){this.last('.x-button').toggleClass('x-button-actived',value!==false);}else{this.base('state');}return this;},init:function(){this.setDropDown(this.createDropDown(this.next('.x-dropdown')));this.find('>.x-button:last-child').on('click',this.toggleDropDown,this);}});var Carousel=Control.extend({onChange:function(from,to){var ul=this.find('.x-carousel-header'),t;if(t=ul.child(from))t.removeClass('x-carousel-selected');if(t=ul.child(to))t.addClass('x-carousel-selected');},currentIndex:0,duration:-1,delay:4000,init:function(options){var me=this,width=me.getWidth(),children=me.children=me.query('.x-carousel-body > li').hide();me.query('.x-carousel-header > li').setWidth(width/children.length).on(options.event||'mouseover',function(e){me.moveTo(this.index());});children.item(0).show();me.onChange(null,0);me.start();},_slideTo:function(fromIndex,toIndex,ltr){var me=this,body=me.find('.x-carousel-body'),width=me.getWidth();if(me.animatingIndex==null){me.animatingIndex=toIndex;me.children.hide();if(!ltr){width=-width;}me.children.item(fromIndex).show().node.style.left=0;me.children.item(toIndex).show().node.style.left=width+'px';body.animate({left:'0-'+ -width},this.duration,function(){var animatingIndex=me.animatingIndex;var finalIndex=me.finalIndex;me.animatingIndex=null;if(finalIndex!=null&&finalIndex!==animatingIndex){me.finalIndex=null;me._slideTo(animatingIndex,finalIndex,animatingIndex<finalIndex);}});}else{me.finalIndex=toIndex;}return toIndex;},moveTo:function(index,ltr){var timer=this.timer,currentIndex=this.currentIndex;if(timer){clearTimeout(timer);}if(index!=currentIndex){index%=this.children.length;this.currentIndex=index;this.onChange(currentIndex,index);this._slideTo(currentIndex,index,ltr||currentIndex<index);}if(timer){this.timer=setTimeout(this.step,this.delay);}return this;},moveBy:function(delta){return this.moveTo(this.currentIndex+delta);},prev:function(){return this.moveBy(-1);},next:function(){return this.moveBy(1);},start:function(){var me=this;if(!me.timer){me.step=function(){me.moveTo(me.currentIndex+1,true);}me.timer=setTimeout(me.step,me.delay);}return me;},stop:function(){if(this.timer){clearTimeout(this.timer);this.timer=0;}return this;}});var ProgressBar=Control.extend({xtype:'progressbar',tpl:'<div class="x-control">                <div class="x-progressbar-fore"></div>            </div>',setValue:function(value){this.find('.x-progressbar-fore').node.style.width=value+'%';return this;},getValue:function(){return parseInt(this.find('.x-progressbar-fore').node.style.width);}});Dom.keys={'13':'enter','10':'enter',up:38,down:40,left:37,right:39,esc:27,tab:9,backspace:8,'delete':46,space:32};Dom.implement({keyNav:function(options,scope){var opt={};for(var key in options){opt[Dom.keys[key]||key]=options[key];}this.on('keydown',function(e){var keyCode=e.keyCode;if(opt[keyCode]){return opt[keyCode].call(this,e)===true;}},scope);if(opt.enter){this.on('keypress',function(e){var keyCode=e.keyCode;if(keyCode===13||keyCode===10){return opt.enter.call(this,e)===true;}});}if(opt.other){this.on('keyup',function(e){var keyCode=e.keyCode;if(!opt[keyCode]&&!(opt.enter&&(keyCode===13||keyCode===10))){return opt.other.call(this,e);}});}return this;}});var DropDownMenu=ListControl.extend({xtype:"listbox",_handleUpDown:function(next){if(this.isDropDownHidden()){this.showDropDown();}else{var item=this.dropDown._hovering;if(item){item=item[next?'next':'prev']();}if(!item){item=this.dropDown[next?'first':'last']();}this.dropDown.hovering(item);}},_handleEnter:function(next){if(this.isDropDownHidden()){return true;}this[this.dropDown.selectMethod](this.dropDown._hovering);},onItemClick:function(item){this.owner[this.selectMethod](item);return false;},constructor:function(options){assert(options&&options.owner&&options.selectMethod,"DropDownMenu#constructor(options): {options} 必须有 owner 和 selectMethod 字段",options);var me=this;me.owner=options.owner;me.selectMethod=options.selectMethod;me.updateMethod=options.updateMethod;me.node=options.node?Dom.getNode(options.node):me.create();ListControl.prototype.init.apply(me,arguments);me.itemOn('mouseover',me.hovering);me.itemOn('mousedown',me.onItemClick);options.owner.keyNav({up:function(){me._handleUpDown.call(this,false);},down:function(){me._handleUpDown.call(this,true);},enter:me._handleEnter,esc:function(){this.hideDropDown();},other:options.updateMethod&&function(){this[this.dropDown.updateMethod]();}});},hovering:function(item){var clazz='x-'+this.xtype+'-hover';if(this._hovering){this._hovering.removeClass(clazz);}this._hovering=item?item.addClass(clazz):null;return this;}});var Suggest=Control.extend(IDropDownOwner).implement({createDropDown:function(existDom){return new DropDownMenu({node:existDom,owner:this,selectMethod:'selectItem',updateMethod:'showDropDown'}).addClass('x-suggest');},onDropDownShow:function(){var text=this.getText();var items=this.getSuggestItems(text);if(!items||!items.length||(items.length===1&&items[0]===text)){this.hideDropDown();}else{this.dropDown.set(items);this.dropDown.hovering(this.dropDown.item(0));}IDropDownOwner.onDropDownShow.apply(this,arguments);},init:function(options){var inSuggest;this.setAttr('autocomplete','off').setDropDown(this.createDropDown(this.next('x-suggest'))).on('focus',this.showDropDown).on('blur',function(){var me=this;setTimeout(function(){if(!inSuggest){me.hideDropDown();}},20);});this.dropDown.setStyle('outline','none').setAttr('tabindex',-1).on('mousedown',function(){inSuggest=true;}).on('mouseleave',function(){inSuggest=false;});},getSuggestItems:function(text){if(!text){return this.suggestItems;}text=text.toLowerCase();return this.suggestItems.filter(function(value){return value.toLowerCase().indexOf(text)>=0;});},setSuggestItems:function(value){this.suggestItems=value||[];return this;},selectItem:function(item){if(item){this.setText(item.getText()).focus();}return this.hideDropDown();}});var ContainerControl=Control.extend({tpl:'<div class="x-control">			<div class="x-control-body"></div>		</div>',headerTpl:'<div class="x-control-header"><h4></h4></div>',header:function(){return this.find('.x-'+this.xtype+'-header');},body:function(){return this.find('.x-'+this.xtype+'-body')||this;},getTitle:function(valueAsText){var header=this.header();return header?(header.last()||header)[valueAsText?'getText':'getHtml']():null;},setTitle:function(value,valueAsText){var header=this.header(),title;if(value===null){header&&header.remove();}else{if(!header){header=this.prepend(this.headerTpl.replace(/control/g,this.xtype));}title=header.last()||header;title[valueAsText?'setText':'setHtml'](value);}return this;},getContent:function(valueAsText){var body=this.body(),content=body.last();if(!content||content.prev()){content=body;}return content[valueAsText?'getText':'getHtml']();},setContent:function(value,valueAsText){var body=this.body(),contentClass='x-'+this.xtype+'-content',content=body.find(contentClass);if(!content){body.setHtml('<div class="'+contentClass+'"></div>');content=body.first();}content[valueAsText?'setText':'setHtml'](value);return this;},getText:function(){return this.getContent(true);},setText:function(value){return this.setContent(value,true);},getHtml:function(){return this.getContent(false);},setHtml:function(value){return this.setContent(value,false);}});var Panel=ContainerControl.extend({xtype:'panel'});var IToolTip={initialDelay:500,reshowDelay:100,menuTpl:'<span>	    <span class="x-arrow-fore">◆</span>        <span class="x-arrow-back">◆</span>    </span>',showDuration:-2,show:function(){if(!this.closest('body')){this.appendTo();}return Dom.prototype.show.call(this,arguments,{duration:this.showDuration});},hide:function(){return Dom.prototype.hide.call(this,arguments,{duration:this.showDuration});},showAt:function(x,y){return this.show().setPosition(x,y);},showBy:function(ctrl,offsetX,offsetY,e){var configs=({left:['rr-yc',15,0],right:['ll-yc',15,0],top:['xc-bb',0,15],bottom:['xc-tt',0,15],'null':['xc-bb',0,5,1]}[this.getArrow()]);this.show().pin(ctrl,configs[0],offsetX===undefined?configs[1]:offsetX,offsetY===undefined?configs[2]:offsetY,false);if(configs[3]&&e){this.setPosition(e.pageX+(offsetX||0));}return this;},setArrow:function(value){var arrow=this.find('.x-arrow')||this.append(this.menuTpl);if(value){arrow.node.className='x-arrow x-arrow-'+value;}else{arrow.remove();}return this;},getArrow:function(){var arrow=this.find('.x-arrow'),r=null;if(arrow){r=(/\bx-arrow-(top|bottom|left|right)/.exec(arrow.node.className)||[0,r])[1];}return r;},setToolTip:function(ctrl,caption,offsetX,offsetY){ctrl=Dom.get(ctrl);var me=this;ctrl.on('mouseover',function(e){var waitTimeout=me.isHidden()?me.initialDelay:me.reshowDelay;if(me.showTimer)clearTimeout(me.showTimer);me.showTimer=setTimeout(function(){me.showTimer=0;if(caption)me.setText(caption);me.showBy(ctrl,offsetX,offsetY,e);},waitTimeout);},this);ctrl.on('mouseout',function(){if(me.showTimer){clearTimeout(me.showTimer);}this.hide();},this);return this;}};var TextBox=Control.extend(IInput).implement({xtype:'textbox',tpl:'<input type="text" class="x-control">'});var RadioButton=Control.extend(IInput).implement({xtype:'radiobutton',tpl:'<input type="radio" class="x-control">'});var CheckBox=Control.extend(IInput).implement({xtype:'checkbox',tpl:'<input type="checkbox" class="x-control">'});var FileUpload=Control.extend(IInput).implement({xtype:'fileupload',tpl:'<span class="x-control">			<input type="fileundefined">			<button class="x-button">浏览...</button>    	</span>',init:function(){var textBox=this.prev('[type=text]')||this.next('[type=text]');if(textBox){this.setTextBox(textBox);}},setTextBox:function(textBox){textBox=Dom.get(textBox).setAttr('readonly',true);this.find('[type=file]').node.onchange=function(){textBox.setText(this.value);};},state:function(name,value){if(name==='disabled'||name==='readonly'){this.find('[type=file]').setAttr('disabled',value);this.query('.x-button').toggleClass('x-button-disabled',value);}else{IInput.state.call(name,value);}return this;}});var Picker=Control.extend(IInput).implement(IDropDownOwner).implement({listMode:true,tpl:'<span class="x-picker">			<input type="text" class="x-textbox"/>		</span>',menuButtonTpl:'<button class="x-button" type="button"><span class="x-menubutton-arrow"></span></button>',button:function(){return this.find('button');},updateDropDown:Function.empty,onDropDownShow:function(){this.updateDropDown();this.state('actived',true);IDropDownOwner.onDropDownShow.apply(this,arguments);},onDropDownHide:function(){this.state('actived',false);IDropDownOwner.onDropDownHide.apply(this,arguments);},state:function(name,value){value=value!==false;if(name=="disabled"||name=="readonly"){this.query('.x-button,button').setAttr("disabled",value).toggleClass("x-button-disabled",value);this.input().setAttr(name,value).toggleClass("x-textbox-"+name,value);}else if(name=="actived"){this.query('.x-button,button').toggleClass("x-button-actived",value);}else{IInput.state.call(this,name,value);}},createDropDown:function(existDom){return existDom;},init:function(options){var me=this,elem;if(!me.first()&&!me.hasClass('x-picker')){elem=me.node;me.node=Dom.createNode('span','x-picker x-'+me.xtype);if(elem.parentNode){elem.parentNode.replaceChild(me.node,elem);}me.prepend(elem);}if(!me.button()){me.append(me.menuButtonTpl);}if('listMode'in options){me.listMode=options.listMode;}else if(me.first().node.tagName!=='INPUT'){me.listMode=true;}me.setDropDown(me.createDropDown(me.next('.x-dropdown')));(me.listMode?me:me.button()).on('click',me.toggleDropDown,me);if(me.listMode&&me.input().node.tagName==='INPUT'){me.on('keyup',function(){this.updateDropDown();},this);}},setText:function(value){this.input().setText(value);this.updateDropDown();return this;},setWidth:function(value){var first=this.first();if(value>=0){value-=this.getWidth()-first.getWidth();}first.setWidth(value);return this;}}).addEvents('change select',{add:function(picker,type,fn){Dom.$event.$default.add(picker.input(),type,fn);},remove:function(picker,type,fn){Dom.$event.$default.remove(picker.input(),type,fn);}});var SearchTextBox=Picker.extend({xtype:'searchtextbox',tpl:'<span class="x-picker">				<input type="text" class="x-textbox x-searchtextbox"/>			</span>',menuButtonTpl:'<button class="x-searchtextbox-search"></button>',onKeyDown:function(e){if(e.keyCode===10||e.keyCode===13){this.search();}},search:function(){var text=this.getText();if(text){this.onSearch(text);this.trigger('search',text);}},onSearch:Function.empty,init:function(){if(!this.first()&&!this.hasClass('x-picker')){var elem=this.node;this.node=Dom.createNode('span','x-picker');if(elem.parentNode){elem.parentNode.replaceChild(this.node,elem);}this.prepend(elem);}if(!this.button()){this.append(this.menuButtonTpl);}var textBox=this.input();textBox.on('focus',textBox.select);this.button().on('click',this.search,this);textBox.on('keydown',this.onKeyDown,this);if(navigator.isIE6){textBox.on('keypress',this.onKeyDown,this);}}});var ComboBox=Picker.extend({listMode:false,xtype:'combobox',autoResize:true,createDropDown:function(existDom){return new DropDownMenu({node:existDom,owner:this,selectMethod:'selectItem'});},updateDropDown:function(){this.dropDown.hovering(this.getSelectedItem());},init:function(options){var selectDom;if(this.node.tagName==='SELECT'){this.selectDom=selectDom=new Dom(this.node);this.node=this.create();}this.base('init');if(selectDom){this.copyItemsFromSelect(selectDom);selectDom.hide();selectDom.after(this);}},selectItem:function(item){var me=this,old;if(me.trigger('selecting',item)){old=me.getText();me.setSelectedItem(item);if(old!==me.getText()){me.trigger('change');}me.hideDropDown();}return me;},setSelectedItem:function(item){this.setText(item?item.getText():"");return this;},getSelectedItem:function(){var value=this.getText();return this.dropDown.child(function(dom){return Dom.getText(dom)===value;});},setSelectedIndex:function(value){return this.setSelectedItem(this.dropDown.item(value));},getSelectedIndex:function(){return this.dropDown.indexOf(this.getSelectedItem());},resizeToFitItems:function(){var dropDown=this.dropDown,oldWidth=dropDown.getStyle('width'),oldDisplay=dropDown.getStyle('display');dropDown.setStyle('display','inline-block');dropDown.setWidth('auto');this.first().setSize(dropDown.getWidth());dropDown.setStyle('width',oldWidth);dropDown.setStyle('display',oldDisplay);return this;},copyItemsFromSelect:function(select){this.dropDown.empty();for(var node=select.node.firstChild;node;node=node.nextSibling){if(node.tagName==='OPTION'){var item=this.dropDown.add(Dom.getText(node));item.dataField().option=node;if(node.selected){this.setSelectedItem(item);}}}if(select.node.onclick)this.node.onclick=select.node.onclick;if(select.node.onchange)this.on('change',select.node.onchange);if(this.autoResize)this.setWidth(select.getWidth());if(select.getAttr('disabled')){this.setAttr('disabled',true);}if(select.getAttr('readonly')){this.setAttr('readonly',true);}}});ListControl.aliasMethods(ComboBox,'dropDown');var Dialog=ContainerControl.extend({_centerType:1|2,xtype:'dialog',showDuration:-1,headerTpl:'<div class="x-control-header"><a class="x-dialog-close x-closebutton">×</a><h4></h4></div>',onCloseButtonClick:function(){this.close();},init:function(options){var t;if(!this.hasClass('x-dialog')){t=this.parent();if(t&&t.hasClass('x-dialog-body')){this.node=t.node.parentNode;}else{t=this.node;this.node=this.create(options);this.body().append(t);}}this.delegate('.x-dialog-close','click',this.onCloseButtonClick.bind(this));this.setStyle('display','none');this.query('script').remove();},mask:function(opacity){var mask=this.maskDom||(this.maskDom=Dom.find('.x-mask-dialog')||Dom.create('div','x-mask x-mask-dialog').appendTo());if(opacity===null){mask.hide();}else{mask.show();mask.setSize(document.getScrollSize());if(opacity!=null)mask.setStyle('opacity',opacity);}return this;},setOffset:function(p){if(p.x!=null){this._centerType&=~2;this.setStyle('margin-left',0);}if(p.y!=null){this._centerType&=~1;this.setStyle('margin-top',0);}return this.base('setOffset');},setWidth:function(){return this.base('setWidth').center();},setHeight:function(){return this.base('setHeight').center();},setContent:function(){return this.base('setContent').center();},center:function(){if(this._centerType&1)this.setStyle('margin-top',-this.getHeight()/2+document.getScroll().y);if(this._centerType&2)this.setStyle('margin-left',-this.getWidth()/2+document.getScroll().x);return this;},show:function(){if(!this.closest('body')){this.appendTo();}return Dom.prototype.show.call(this,arguments,{duration:this.showDuration}).center();},showDialog:function(){return this.show.apply(this.mask(),arguments);},hide:function(){if(this.maskDom)this.maskDom.hide();return Dom.prototype.hide.call(this,arguments,{duration:this.showDuration});},setContentSize:function(x,y){this.setWidth('auto');this.body().setWidth(x).setHeight(y);return this.center();},close:function(){var me=this;if(this.trigger('closing'))this.hide({callback:function(){this.trigger('close');}});return this;}});var MessageBox=Dialog.extend({onCloseButtonClick:function(){this.cancel();},onOk:function(){return this.trigger('ok');},onCancel:function(){return this.trigger('cancel');},ok:function(){if(this.onOk()!==false){this.close();}},cancel:function(){if(this.onCancel()!==false){this.close();}},setIcon:function(type){var body=this.body(),content=body.last();if(!content||content.prev()){content=body;}if(type==null){content.node.className=content.node.className.replace(/x-dialog-iconbox\s+x-dialog-iconbox-\w+/,'');}else{content.addClass('x-dialog-iconbox x-dialog-iconbox-'+type);}return this;},setButtons:function(options){if(options==null){this.query('.x-dialog-footer').remove();}else{var footer=this.find('.x-dialog-footer')||Dom.create('div','x-dialog-footer').appendTo(this),key,value,btn;footer.empty();for(key in options){value=options[key];btn=footer.append('<button class="x-button"></button>').setText(key);switch(typeof value){case'boolean':value=value?this.ok:this.cancel;case'function':btn.on('click',value,this);break;case'object':btn.set(value);break;}footer.append('  ');}}return this;}});MessageBox.show=function(text,title,icon,buttons){var messageBox=MessageBox.showInstance||(MessageBox.showInstance=new MessageBox());return messageBox.setContent(text).setTitle(title||"提示").setIcon(icon||null).setButtons(buttons||{'确定':true}).showDialog();};MessageBox.alert=function(text,title){return MessageBox.show(text,title,'warning');};MessageBox.confirm=function(text,title,onOk,onCancel){var messageBox=MessageBox.show(text,title,'confirm',{'确定':{className:'x-button x-button-info',onclick:function(){messageBox.ok();}},'取消':false});if(onOk)messageBox.on('ok',onOk);if(onCancel)messageBox.on('cancel',onCancel);return messageBox;};MessageBox.tip=function(text,icon,timeout,callback){var messageBox=MessageBox.tipInstance||(MessageBox.tipInstance=new MessageBox());messageBox.setContent(text).setIcon(icon).showDialog();messageBox.timer=setTimeout(function(){messageBox.close();if(callback){callback.call(messageBox);}},timeout||3000);return messageBox;};var ToolTip=ContentControl.extend(IToolTip).implement({xtype:'tooltip',menuTpl:'<span>				<span class="x-arrow-fore">◆</span>			</span>',content:function(){return this.find('.x-tooltip-content');}});var Draggable=Class({dragDelay:500,raiseEvent:function(eventName,e){e.draggable=this;return this.target.trigger(eventName,e);},onDragStart:function(e){if(!this.raiseEvent('dragstart',e)){return false;}this.offset=this.proxy.getOffset();},onDrag:function(e){var me=this;me.raiseEvent('drag',e);me.proxy.setOffset({x:me.offset.x+me.to.x-me.from.x,y:me.offset.y+me.to.y-me.from.y});},onDragEnd:function(e){this.raiseEvent('dragend',e);this.offset=null;},handlerMouseDown:function(e){if(e.which!==1)return;if(Draggable.current){Draggable.current.stopDrag(e);}e.preventDefault();var me=this;me.from=new Point(e.pageX,e.pageY);me.to=new Point(e.pageX,e.pageY);me.currentHandler=me.handlerDragStart;me.timer=setTimeout(function(){me.timer=0;me.currentHandler(e);},me.dragDelay);Dom.getDocument(me.handle.node).on('mouseup',me.handlerDragStop,me).on('mousemove',me.handlerMouseMove,me);},handlerMouseMove:function(e){e.preventDefault();this.to.x=e.pageX;this.to.y=e.pageY;this.currentHandler(e);},handlerDragStart:function(e){var me=this;if(me.timer){clearTimeout(me.timer);me.timer=0;}Draggable.current=me;me.currentHandler=me.handlerDrag;if(me.onDragStart(e)!==false){me.beforeDrag(e);me.handlerDrag(e,true);}else{me.stopDragging();}},handlerDrag:function(e){this.onDrag(e);this.doDrag(e);},handlerDragStop:function(e){if(e.which!==1)return;e.preventDefault();var isCurrentDraggable=Draggable.current===this;this.stopDragging();if(isCurrentDraggable){this.afterDrag(e);this.onDragEnd(e);}},beforeDrag:function(e){this.oldCursor=document.documentElement.style.cursor;document.documentElement.style.cursor=this.target.getStyle('cursor');if('pointerEvents'in document.body.style)document.body.style.pointerEvents='none';else if(document.body.setCapture)document.body.setCapture();},doDrag:Function.empty,afterDrag:function(){if(document.body.style.pointerEvents==='none')document.body.style.pointerEvents='';else if(document.body.releaseCapture)document.body.releaseCapture();document.documentElement.style.cursor=this.oldCursor;},constructor:function(options){Object.extend(this,options);this.handle=this.handle||this.target;this.proxy=this.proxy||this.target;this.disable(false);},stopDragging:function(){Dom.getDocument(this.handle.node).un('mousemove',this.handlerMouseMove).un('mouseup',this.handlerDragStop);if(this.timer){clearTimeout(this.timer);this.timer=0;}Draggable.current=null;},disable:function(value){this.handle[value===false?'on':'un']('mousedown',this.handlerMouseDown,this);}});Dom.implement({draggable:function(options){var draggable=this.dataField().draggable;if(options!==false){if(typeof options!=='object')options={};if(draggable){Object.extend(draggable,options);draggable.disable(false);}else{options.target=this;Dom.movable(this.node);draggable=this.dataField().draggable=new Draggable(options);}}else if(draggable)draggable.disable();return this;}});(function(){var droppables=[],dp=Draggable.prototype,Droppable=window.Droppable=Class({raiseEvent:function(eventName,draggable,e){e.draggable=draggable;e.droppable=this;return this.target.trigger(eventName,e);},onDragEnter:function(draggable,e){return this.raiseEvent('dragenter',draggable,e);},onDragOver:function(draggable,e){return this.raiseEvent('dragover',draggable,e);},onDrop:function(draggable,e){return this.raiseEvent('drop',draggable,e);},onDragLeave:function(draggable,e){return this.raiseEvent('dragleave',draggable,e);},constructor:function(options){Object.extend(this,options);this.disable(false);},init:function(draggable){this.lt=this.target.getPosition();this.rb=this.lt.add(this.target.getSize());return true;},check:function(draggable){return this.lt.x<=draggable.to.x&&draggable.to.x<=this.rb.x&&this.lt.y<=draggable.to.y&&draggable.to.y<=this.rb.y;},disable:function(value){droppables[value!==false?'remove':'include'](this);return this;}}),beforeDrag=dp.beforeDrag,afterDrag=dp.afterDrag,mouseEvents=Dom.$event.mousemove;Draggable.implement({beforeDrag:function(e){var me=this;beforeDrag.call(me,e);me.availableDroppables=droppables.filter(function(droppable){return droppable.init(me);});me.droppableFlags=new Array(me.availableDroppables.length);me.droppables=[];},doDrag:function(e){var me=this,i=0,droppables=me.droppables,availableDroppables=me.availableDroppables,droppableFlags=me.droppableFlags,droppable,eventProcess=true;while(i<availableDroppables.length){droppable=availableDroppables[i];if(eventProcess&&droppable.check(me)){if(droppableFlags[i])droppable.onDragOver(me,e);else{droppableFlags[i]=true;eventProcess=droppable.onDragEnter(me,e)!==false;droppables.push(droppable);}}else if(droppableFlags[i]){droppableFlags[i]=false;droppable.onDragLeave(me,e);droppables.remove(droppable);}i++;}},afterDrag:function(e){var me=this;afterDrag.call(me,e);me.droppables.forEach(function(droppable){droppable.onDrop(me,e);});me.droppableFlags=me.availableDroppables=null;}});Dom.addEvents('dragenter dragleave dragover drop',{add:function(dom,type,fn){Dom.$event.$default.add(dom,type,fn);fn=dom.dataField().droppable;if(fn){fn.disable(false);}else{dom.dataField().droppable=new Droppable({target:dom});}},remove:function(dom,type,fn){Dom.$event.$default.remove(dom,type,fn);dom.dataField().droppable.disable();delete dom.dataField().droppable;},initEvent:mouseEvents&&mouseEvents.initEvent});})();Dom.implement({popup:function(options){if(options.constructor!==Object){options={target:Dom.get(options)};}options.target.hide();options.event=options.event||'mouseenter';var me=this,timer,atPopup,atTarget;if(/^mouse(enter|over)\b/.test(options.event)){options.delay=options.delay||300;options.target.on('mouseenter',function(){atPopup=true;}).on('mouseleave',function(){atPopup=false;});me.bind(options.event,function(e){var target=this;atTarget=true;if(timer){clearTimeout(timer);}timer=setTimeout(function(){timer=0;toggle('show',target);},options.delay);});me.bind(/^mouseenter/.test(options.event)?options.event.replace('enter','leave'):options.event.replace('over','out'),function(e){var target=this;atTarget=false;if(timer){clearTimeout(timer);}timer=setTimeout(function(){timer=0;if(!atTarget){if(!atPopup){toggle('hide',target);}else{setTimeout(arguments.callee,options.delay);}}},options.delay);});me.bind(options.event.replace(/^\w+/,"click"),function(e){e.preventDefault();if(timer){clearTimeout(timer);}toggle('show',this);})}else if(/'focus(in)?\b/.test(options.event)){me.bind(options.event,function(e){toggle('show',this);});me.bind(/'focusin/.test(options.event)?options.event.replace('focusin','focusout'):options.event.replace('focus','blur'),function(e){toggle('hide',this);});}else{me.bind(options.event,function(e){e.preventDefault();var target=this;toggle('show',target);document.on('click',function(e){if(options.target.has(e.target,true)){return;}toggle('hide',target);document.un('click',arguments.callee);});return false;});}function toggle(showOrHide,target){options.target[showOrHide]();if(options[showOrHide]){options[showOrHide](target);}}return me;}});String.htmlEncode=(function(){var entities={'&':'&amp;','>':'&gt;','<':'&lt;','"':'&quot;'};function match(match,capture){return entities[capture];}return function(value){return value?value.replace(/[&><"]/g,match):'';};})();location.getHash=function(){var href=location.href,i=href.indexOf("#");return i>=0?href.substr(i+1):'';};(function(){var hashchange='hashchange',document=window.document,win=Dom.window,getHash=location.getHash;Dom[hashchange]=function(fn){fn?win.on(hashchange,fn)&&fn.call(win):win.trigger(hashchange);};if('on'+hashchange in window&&!(document.documentMode<8))return;var currentHash,timer,onChange=function(){win.trigger(hashchange);},poll=function(){var newToken=getHash();if(currentHash!==newToken){currentHash=newToken;onChange();}timer=setTimeout(poll,50);},start=function(){currentHash=getHash();timer=setTimeout(poll,50);},stop=function(){clearTimeout(timer);};if(navigator.isQuirks){var iframe;start=function(){if(!iframe){Dom.ready(function(){iframe=Dom.parse('<iframe style="display: none" height="0" width="0" tabindex="-1" title="empty"/>');iframe.once('load',function(){this.on("load",function(){var newHash=iframe.contentWindow.document.body.innerText,oldHash=getHash();if(oldHash!=newHash){location.hash=currentHash=newHash;win.trigger(hashchange);}});currentHash=getHash();poll();});iframe=iframe.node;document.body.appendChild(iframe);});}else{currentHash=getHash();poll();}};onChange=function(){var hash=getHash();var html="<html><body>"+String.htmlEncode(hash)+"</body></html>";try{var doc=iframe.contentWindow.document;doc.open();doc.write(html);doc.close();}catch(e){}win.trigger(hashchange);};}Dom.addEvents('hashchange',{add:start,remove:stop});})();var BalloonTip=ContainerControl.extend(IToolTip).implement({xtype:'balloontip'});var EmailSuggest=Suggest.extend({mails:" @126.com @139.com @163.com @gmail.com @hotmail.cn @hotmail.com @qq.com @sina.com @sohu.com @vip.163.com @vip.qq.com @yahoo.cn @yahoo.com.cn".split(' '),getSuggestItems:function(value){if(!value)return null;var r=[],v=value.indexOf('@')!==-1?value.substr(0,value.indexOf('@')):value;this.mails.each(function(m){if((v+m).indexOf(value)===0)r.push(v+m);});return r;}});var DropDownList=ComboBox.extend({tpl:'<span class="x-picker">			<a href="javascript:;" class="x-button">A</a>		</span>',input:function(){return this.selectDom||(this.selectDom=Dom.create('select').setAttr('name',Dom.getAttr(this.node,'name')).hide().appendTo(this));},init:function(options){options.listMode=true;this.base('init');},setSelectedItem:function(item){var text,input=this.input();if(item){var option=item.dataField().option;if(!option){item.dataField().option=option=new Option(item.getText(),this.getValueOfItem(item));input.node.add(option);}option.selected=true;text=Dom.getText(option);}else{input.node.selectedIndex=-1;text=input.getAttr('placeholder');}this.first().setText(text);return this;},getValueOfItem:function(item){assert.notNull(item,"ComboBox#getValueOfItem(item): {item} ~",item);var option=item.dataField().option;return option?option.value:(item.getAttr('data-value')||item.getText());},setText:function(value){this.input().setText(value);return this.setSelectedItem(this.getSelectedItem());},selectItem:function(item){var me=this,old;if(me.trigger('selecting',item)){old=me.getSelectedItem();me.setSelectedItem(item);if(!(old?old.equals(item):item)){me.trigger('change');}me.hideDropDown();}return me;},getSelectedItem:function(){var value=this.input().getAttr('selectedIndex');return value<0?null:this.dropDown.item(value);}});Date.implement({toString:function(){var args={"d":'getDate',"h":'getHours',"m":'getMinutes',"s":'getSeconds'},rDate=/(yy|M|d|h|m|s)\1?/g,toString=Date.prototype.toString;return function(format){var me=this;if(!format)return toString.call(me);return format.replace(rDate,function replace(key,reg){var l=key!=reg,t;switch(reg){case'yy':t=me.getFullYear();return l&&t||(t%100);case'M':t=me.getMonth()+1;break;default:t=me[args[reg]]();}return l&&t<=9&&("0"+t)||t;});}}(),dayDiff:function(month,day){var me=this,x=Date.compare(new Date([me.getFullYear(),me.getMonth()+1,me.getDate()].join('/')),new Date([me.getFullYear(),month,day].join('/')));return(x<0?(me.getMonth()<2&&Date.isLeapYear(me.getFullYear())?366:365):0)+x;},clone:function(){return new Date(this.getTime());},addDay:function(value){this.setDate(this.getDate()+value);return this;},addWeek:function(value){return this.addDay(value*7);},addMonth:function(value){this.setMonth(this.getMonth()+value);return this;},addYear:function(value){this.setFullYear(parseInt(this.getFullYear())+value);return this;}});Object.extendIf(Date,{compare:function(date1,date2,on){var a;if(on)a=new Date(date2.toString())-new Date(date1.toString());else a=date2-date1;return parseInt(a/86400000);},isLeapYear:function(year){return((year%4==0&&year%100!=0)||year%400==0);},_dayInMonth:[30,31,28,31,30,31,30,31,31,30,31,30,31],getDayInMonth:function(year,month){if(month==2)return Date.isLeapYear(year)?29:28;return _dayInMonth[month];}});var MonthCalender=Control.extend({xtype:'monthcalender',tpl:'<div class="x-monthcalender">		       <div class="x-monthcalender-main">		        <div class="x-monthcalender-header">		            <a class="x-monthcalender-next" href="javascript://下一页">▸</a>		            <a class="x-monthcalender-previous" href="javascript://上一页">◂</a>		            <a class="x-monthcalender-title" href="javascript://返回上一级"></a>		        </div>		        <div class="x-monthcalender-body">		            <div class="x-monthcalender-content">		                <div style="left:1px; top:1px;"></div>						<div style="left:172px; top:1px;"></div>					</div>		        </div>		    	<div class="x-monthcalender-footer">		    		<a href="javascript://选择今天"></a>		    	</div>		      </div>			</div>',duration:-1,_toggleContentBySlide:function(oldLeft,sliderLeft,newLeft,tweenLeft,duration){var oldContent=this.content,newContent=this.contentProxy,slider=newContent.parent();oldContent.node.style.left=oldLeft+'px';slider.node.style.left=sliderLeft+'px';newContent.node.style.left=newLeft+'px';slider.animate({left:tweenLeft},duration,null,'replace');this.content=newContent;this.contentProxy=oldContent;},_toggleContentByFade:function(duration){var me=this,oldContent=me.content,newContent=me.contentProxy,slider=newContent.node.parentNode,newStyle=newContent.node.style,oldStyle=oldContent.node.style;newContent.setStyle('opacityundefinedpx';newStyle.zIndex=2;oldStyle.zIndex=1;newContent.animate({opacity:1},duration,null,'replaceundefinedpx';oldStyle.left=me._widthCache+'px';oldContent.setStyle('opacity',1);},'replace');me.content=newContent;me.contentProxy=oldContent;},onItemClick:function(item){if(!item.hasClass('x-monthcalender-disabled')){this.selectItem(item);}return false;},onPrevClick:function(){var me=this;me.view.move(me,-1);me.view.render(me,true);me._toggleContentBySlide(me._widthCache,-me._widthCache,1,1,this.duration);return false;},onNextClick:function(){var me=this;me.view.move(me,1);me.view.render(me,true);me._toggleContentBySlide(1,1,me._widthCache,-me._widthCache,this.duration);return false;},onTitleClick:function(){this.setView(MonthCalender[this.view.parentView]);},onTodayClick:function(){var today=this.getToday();if(!(today<this.minValue||today>this.maxValue)){this.setValue(today);this.onItemClick(this.find('.x-monthcalender-selected'));}return this;},init:function(options){var me=this.unselectable();me.bind({'click.x-monthcalender-title':me.onTitleClick.bind(me),'click.x-monthcalender-previous':me.onPrevClick.bind(me),'click.x-monthcalender-next':me.onNextClick.bind(me),'click.x-monthcalender-footer a':me.onTodayClick.bind(me),'click.x-monthcalender-content a':function(){return me.view.select(me,this);}});var contents=me.find('.x-monthcalender-content');me.content=contents.first();me.contentProxy=contents.last();options.today=options.today||new Date();options.value=options.value||new Date();me._widthCache=this.getWidth()||172;this.displayedValue=options.value;},setToday:function(value){this.find('.x-monthcalender-footer a').setHtml(value.toString(MonthCalender.todayFormat));this.today=value;},getToday:function(){return this.today;},setView:function(view,duration){if(duration!==0){view.render(this,true);this.view=view;this._toggleContentByFade(duration||this.duration);}else{view.render(this);this.view=view;}return this;},selectItem:function(item){var value=new Date(this.displayedValue.getFullYear(),this.displayedValue.getMonth(),parseInt(item.getText()));if(this.trigger('selecting',value)){var oldValue=this.getValue();this.setValue(value);if(value-oldValue>0){this.trigger('change');}}return this;},setValue:function(value){this.value=value;this.displayedValue=value.clone();this.setView(MonthCalender.DayView,0);return this;},getValue:function(fn){return this.value;},limit:function(minValue,maxValue){this.minValue=minValue;this.maxValue=maxValue;this.view.render(this);return this;}}).addEvents('change');Object.extend(MonthCalender,{_isMonthOf:function(date,displayedYear,displayedMonth){return date.getFullYear()===displayedYear&&date.getMonth()===displayedMonth;},_renderContentOfMonthYears:function(calender,useProxy,contentGetter){var html='',c=0,i=0,j;while(i++<3){html+='<div>';for(j=0;j<4;j++){html+=contentGetter(c++);}html+='</div>';}calender[useProxy?'contentProxy':'content'].setHtml(html).node.className='x-monthcalender-monthyears';},DayView:{render:function(calender,useProxy){var currentValue=calender.getValue(),today=calender.getToday(),displayedYear=calender.displayedValue.getFullYear(),displayedMonth=calender.displayedValue.getMonth(),minValue=calender.minValue,maxValue=calender.maxValue,selectedDate=MonthCalender._isMonthOf(currentValue,displayedYear,displayedMonth)?currentValue.getDate():0,activedDate=MonthCalender._isMonthOf(today,displayedYear,displayedMonth)?today.getDate():0,html='',i=0,j,day,altClassType=-1,value=new Date(displayedYear,displayedMonth,1);html+='<div class="x-monthcalender-week">';for(j in MonthCalender.weeks){html+='<span class="x-monthcalender-'+j+'">'+MonthCalender.weeks[j]+'</span>';}html+='</div>';day=value.getDay();value.addDay(day===0?-7:-day);while(i++<6){html+='<div>';for(j=0;j<7;j++){html+='<a href="javascript:;" class="';day=value.getDate();if(day==1){altClassType++;}if(value<minValue||value>maxValue){html+='x-monthcalender-disabled ';}else if(altClassType!==0){html+='x-monthcalender-alt '+(altClassType?'x-monthcalender-alt-prev ':'x-monthcalender-alt-next ');}else{if(activedDate==day){html+='x-monthcalender-actived ';}if(selectedDate==day){html+='x-monthcalender-selected ';}}html+='">'+day+'</a>';value.setDate(day+1);}html+='</div>';}calender[useProxy?'contentProxy':'content'].setHtml(html).node.className='x-monthcalender-days';calender.query('.x-monthcalender-title').setText(calender.displayedValue.toString(MonthCalender.monthFormat));},parentView:'MonthView',select:function(calender,item){if(item.hasClass('x-monthcalender-alt')){var day=parseInt(item.getText());calender.value=new Date(calender.displayedValue.getFullYear(),calender.displayedValue.getMonth()+(day<15?1:-1),day);return calender[day<15?'onNextClick':'onPrevClick']();}return calender.onItemClick(item);},move:function(calender,delta){calender.displayedValue.addMonth(delta);}},MonthView:{render:function(calender,useProxy){var displayedYear=calender.displayedValue.getFullYear(),displayedMonth=calender.displayedValue.getMonth(),minValue=calender.minValue,maxValue=calender.maxValue,selectedMonth=MonthCalender._isMonthOf(calender.getValue(),displayedYear,displayedMonth)?displayedMonth:-1,activedMonth=MonthCalender._isMonthOf(calender.getToday(),displayedYear,displayedMonth)?displayedMonth:-1,months=MonthCalender.months,value=new Date(displayedYear,0);MonthCalender._renderContentOfMonthYears(calender,useProxy,function(c){value.setMonth(c);var html='<a href="javascript:;" data-value="'+c+'" class="';if(value<minValue||value>maxValue){html+='x-monthcalender-disabled ';}if(selectedMonth==c){html+='x-monthcalender-selected ';}html+='">'+months[c]+'</a>';return html;});calender.query('.x-monthcalender-title').setText(displayedYear);},select:function(calender,item){calender.displayedValue.setMonth(+item.getAttr('data-value'));calender.setView(MonthCalender.DayView);},parentView:'YearView',move:function(calender,delta){calender.displayedValue.addYear(delta);}},YearView:{render:function(calender,useProxy){var displayedYear=calender.displayedValue.getFullYear(),minValue=calender.minValue&&calender.minValue.getFullYear(),maxValue=calender.maxValue&&calender.maxValue.getFullYear(),selectedYear=calender.getValue().getFullYear(),activedYear=calender.getToday().getFullYear(),value=((displayedYear/10)|0)*10;calender.query('.x-monthcalender-title').setText(value+'-'+(value+9));value--;MonthCalender._renderContentOfMonthYears(calender,useProxy,function(c){var html='<a href="javascript:;" class="';if(value<minValue||value>maxValue){html+='x-monthcalender-disabled ';}if(c===0||c===11){html+='x-monthcalender-alt ';}if(selectedYear==value){html+='x-monthcalender-selected ';}if(activedYear==value){html+='x-monthcalender-selected ';}html+='">'+value+'</a>';value++;return html;});},select:function(calender,item){calender.displayedValue.setYear(+item.getText());calender.setView(MonthCalender.MonthView);},parentView:'DecadeView',move:function(calender,delta){calender.displayedValue.addYear(delta*10);}},DecadeView:{render:function(calender,useProxy){var displayedYear=calender.displayedValue.getFullYear(),minValue=calender.minValue&&calender.minValue.getFullYear(),maxValue=calender.maxValue&&calender.maxValue.getFullYear(),selectedYear=calender.getValue().getFullYear(),activedYear=calender.getToday().getFullYear(),value=((displayedYear/100)|0)*100;calender.query('.x-monthcalender-title').setText(value+'-'+(value+99));value--;MonthCalender._renderContentOfMonthYears(calender,useProxy,function(c){var html='<a href="javascript:;" data-value="'+(value+5)+'" class="x-monthcalender-decade ';if(value+10<minValue||value>maxValue){html+='x-monthcalender-disabled ';}if(c===0||c===11){html+='x-monthcalender-alt ';}if(selectedYear>=value&&selectedYear<=value+9){html+='x-monthcalender-selected ';}if(activedYear>=value&&activedYear<=value+9){html+='x-monthcalender-selected ';}html+='">'+value+'-<br>'+(value+9)+'&nbsp;</a>';value+=10;return html;});},parentView:'DecadeView',select:function(calender,item){calender.displayedValue.setYear(+item.getAttr('data-value'));calender.setView(MonthCalender.YearView);},move:function(calender,delta){calender.displayedValue.addYear(delta*100);}},months:"一月 二月 三月 四月 五月 六月 七月 八月 九月 十月 十一月 十二月".split(' '),weeks:{sunday:'日',monday:'一',tuesday:'二',wednesday:'三',thursday:'四',friday:'五',saturday:'六'},monthFormat:'yyyy年M月',todayFormat:'今天: yyyy年M月d日'});var DatePicker=Picker.extend({dataStringFormat:'yyyy/M/d',dropDownWidth:'auto',menuButtonTpl:'<button class="x-button" type="button"><span class="x-icon x-icon-calendar"></span></button>',createDropDown:function(existDom){return new MonthCalender(existDom).on('selecting',this.onItemClick,this);},onItemClick:function(value){if(this.trigger('selecting',value)){var old=this.getValue();this.setValue(value).hideDropDown();if(old!==value){this.trigger('change');}return;}return false;},selectItem:function(value){this.onItemClick(value);return this;},updateDropDown:function(){var d=new Date(this.getText());if(!isNaN(d.getYear()))this.dropDown.setValue(d);},getValue:function(){return new Date(this.getText());},setValue:function(value){return this.setText(value.toString(this.dataStringFormat));}});var UpDown=Picker.extend({menuButtonTpl:'<button type="button" class="x-button x-updown-button-up">                        <span class="x-menubutton-arrow"></span>                    </button>                    <button type="button" class="x-button x-updown-button-down">                        <span class="x-menubutton-arrow"></span>                    </button>',changeSpeed:90,holdDuration:600,_bindEvent:function(d,fn){var me=this;d=this.find('.x-updown-button-'+d).node;d.onmousedown=function(){me[fn]();if(me.timer)clearInterval(me.timer);me.timer=setTimeout(function(){me.timer=setInterval(function(){me[fn]();},me.changeSpeed);},me.holdDuration);};d.onmouseout=d.onmouseup=function(){clearTimeout(me.timer);clearInterval(me.timer);me.timer=0;};},init:function(options){this.base('init',options);this._bindEvent('up','onUp');this._bindEvent('down','onDown');this.keyNav({up:this.onUp,down:this.onDown});},onUp:Function.empty,onDown:Function.empty});var NumericUpDown=UpDown.extend({delta:1,onUp:function(){this.setText((parseFloat(this.getText())||0)+this.delta);},onDown:function(){this.setText((parseFloat(this.getText())||0)-this.delta);}});var TagChooser=Class({seperator:' ',prefix:'✚ ',onTargetChange:function(){var seperator=this.seperator,content=seperator+this.target.getText()+seperator;this.tags.each(function(value){value=Dom.get(value);value.toggleClass('x-tagchooser-selected',content.indexOf(seperator+value.getText().substr(2)+seperator)>-1);});},onTagClick:function(tag){var seperator=this.seperator,value=this.target.getText(),newValue=tag.getText().substr(this.prefix.length);if(tag.hasClass('x-tagchooser-selected')){value=value.split(seperator);while(value.remove(newValue)>=0);this.target.setText(value.join(seperator));tag.removeClass('x-tagchooser-selected');}else if((seperator+value+seperator).indexOf(seperator+newValue+seperator)===-1){tag.addClass('x-tagchooser-selected');this.target.setText((value?value+seperator:value)+newValue);}else{tag.addClass('x-tagchooser-selected');}},constructor:function(target,tags,prefix){var me=this;me.target=Dom.get(target);me.tags=Dom.query(tags);if(prefix!==undefined){this.prefix=prefix;}me.tags.on('click',function(){me.onTagClick(this);}).each(function(value){var node=Dom.get(value);node.setText(this.prefix+node.getText());},me);me.target.on('keyup',me.onTargetChange,me);me.onTargetChange();}});var CharCounter=Control.extend({maxLength:300,tpl:'<span class="x-charcounter"></span>',message:'还可以输入<span class="x-charcounter-success"> {0} </span>个字符',errorMessage:'已超过<span class="x-charcounter-error"> {0} </span>个字符',isValidated:function(){return this.target.getText().length<=this.maxLength;},update:function(){var len=this.target.getText().length-this.maxLength;if(len>0){this.setHtml(String.format(this.errorMessage,len,this.maxLength));}else{this.setHtml(String.format(this.message,-len,this.maxLength));}},constructor:function(target,maxLength,tip){this.target=target=Dom.get(target);if(maxLength)maxLength=this.maxLength;tip=(tip?Dom.get(tip):target.siblings('.x-charcounter').item(0))||target.after(this.tpl);this.node=tip.node;target.on('keyup',this.update,this);this.update()}});